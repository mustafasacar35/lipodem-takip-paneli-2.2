<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîó Manuel E≈üle≈ütirme Paneli</title>
    
    <!-- Global App Config -->
    <script src="config.js"></script>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js" crossorigin="anonymous"></script>
    
    <!-- Initialize Supabase Client -->
    <script>
        // Supabase client'ƒ± ba≈ülat (DAL'dan √∂nce olmalƒ±)
        if (typeof supabase !== 'undefined' && CONFIG?.SUPABASE_URL && CONFIG?.SUPABASE_ANON_KEY) {
            window.supabase = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase client ba≈ülatƒ±ldƒ± (eslestirme.html)');
        } else {
            console.warn('‚ö†Ô∏è Supabase ba≈ülatƒ±lamadƒ± - CONFIG veya SDK yok');
        }
    </script>
    
    <!-- Data Access Layer (DAL) - Supabase i≈ülemleri i√ßin -->
    <script src="data-access-layer.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box.total {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-box.matched {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .stat-box.unmatched {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #667eea;
            border-radius: 10px;
            outline: none;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .food-card {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .food-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .food-card.matched {
            border-color: #28a745;
            background: #f0fff4;
        }

        .food-card.matched::before {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .food-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .food-meta {
            font-size: 12px;
            color: #666;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .meta-tag {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 20px;
        }

        .close-btn {
            background: #dc3545;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tarif-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .tarif-item {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .tarif-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .tarif-item.selected {
            border-color: #28a745;
            background: #f0fff4;
        }

        .tarif-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .tarif-name {
            font-size: 12px;
            color: #333;
            word-break: break-word;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .current-match {
            background: #fff3cd;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #ffc107;
        }

        .current-match strong {
            color: #856404;
        }

        /* Tab Styles */
        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: #667eea;
            background: #f8f9fa;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Test √ñnizleme Paneli */
        .preview-panel {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 400px;
            max-height: 90vh;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: auto;
            display: none;
            z-index: 999;
        }

        .preview-panel.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Sƒ±ralama Kontrolleri */
        .sort-controls {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .sort-controls span {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .sort-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
        }

        .sort-btn:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .sort-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Action Butonlarƒ± (D√ºzenle/Sil) */
        .food-card-actions {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
        }

        .action-btn {
            flex: 1;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .edit-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 2px 4px;
            font-size: 14px;
            min-width: auto;
            line-height: 1;
        }

        .edit-btn:hover {
            background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
            transform: scale(1.1);
        }

        .delete-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 2px 4px;
            font-size: 14px;
            min-width: auto;
            line-height: 1;
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
            transform: scale(1.1);
        }

        /* D√ºzenleme Modali */
        .edit-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        .edit-modal-overlay.active {
            display: flex;
        }

        .edit-modal-content {
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .edit-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .edit-modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .edit-modal-body {
            padding: 25px;
        }

        .edit-modal-footer {
            padding: 15px 25px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            cursor: pointer;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 500;
        }

        .save-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .save-btn:hover {
            background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-btn:hover {
            background: #5a6268;
        }

        .modal-close {
            background: white;
            color: #667eea;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f8f9fa;
            transform: rotate(90deg);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .sort-controls {
                justify-content: center;
            }

            .edit-modal-content {
                width: 95%;
                max-height: 95vh;
            }
        }

        @media (max-width: 576px) {
            .sort-btn {
                font-size: 11px;
                padding: 6px 12px;
            }

            .action-btn {
                font-size: 11px;
                padding: 5px 10px;
            }

            .edit-modal-body {
                padding: 15px;
            }
        }

        .preview-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .preview-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }

        .preview-body {
            padding: 15px;
        }

        .preview-input {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 2px solid #667eea;
            border-radius: 8px;
            margin-bottom: 15px;
            outline: none;
        }

        .match-result {
            margin-bottom: 15px;
        }

        .match-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .match-badge.manuel {
            background: #007bff;
            color: white;
        }

        .match-badge.yasak {
            background: #dc3545;
            color: white;
        }

        .match-badge.otomatik {
            background: #28a745;
            color: white;
        }

        .match-badge.none {
            background: #6c757d;
            color: white;
        }

        .match-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .match-card-preview {
            position: relative;
            width: 80px;
        }

        .match-card-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .match-card-preview .card-name {
            font-size: 10px;
            text-align: center;
            margin-top: 3px;
            color: #666;
            word-break: break-word;
        }

        .preview-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .preview-section:last-child {
            border-bottom: none;
        }

        .preview-section h4 {
            font-size: 13px;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .preview-info {
            font-size: 12px;
            color: #666;
            line-height: 1.6;
        }

        .toggle-preview-btn {
            position: fixed;
            right: 20px;
            top: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            z-index: 998;
            transition: all 0.2s;
        }

        .toggle-preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
    </style>
    
    <!-- DAL (Supabase zaten head'de ba≈ülatƒ±ldƒ±) -->
</head>
<body>
    <!-- Test √ñnizleme Toggle Button -->
    <button class="toggle-preview-btn" onclick="togglePreview()">
        üîç Test √ñnizleme
    </button>
    
    <!-- Debug Test Button -->
    <button style="position: fixed; bottom: 20px; right: 20px; background: #ff6b6b; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; z-index: 998; font-size: 12px;" onclick="testSearch()">
        üêõ Test Arama
    </button>

    <!-- Test √ñnizleme Paneli -->
    <div class="preview-panel" id="previewPanel">
        <div class="preview-header">
            <h3>üîç Canlƒ± Test √ñnizleme</h3>
            <button class="preview-close" onclick="togglePreview()">√ó</button>
        </div>
        <div class="preview-body">
            <input type="text" 
                   class="preview-input" 
                   id="previewInput" 
                   placeholder="Yemek adƒ±nƒ± yazƒ±n..."
                   oninput="updatePreview()">
            
            <div id="previewResults"></div>
        </div>
    </div>

    <!-- Bildirim Container -->
    <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;"></div>

    <div class="container">
        <h1>üîó Manuel E≈üle≈ütirme Paneli</h1>

        <div style="text-align: center; margin-bottom: 15px;">
            <button class="btn btn-save" onclick="refreshData(event)" style="padding: 8px 20px;" id="btnRefreshData">
                üîÑ Supabase'den G√ºncel Veriyi √áek
            </button>
        </div>

        <div class="stats">
            <div class="stat-box total">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Toplam Yemek</div>
            </div>
            <div class="stat-box matched">
                <div class="stat-number" id="matchedCount">0</div>
                <div class="stat-label">E≈üle≈ütirilmi≈ü</div>
            </div>
            <div class="stat-box unmatched">
                <div class="stat-number" id="unmatchedCount">0</div>
                <div class="stat-label">E≈üle≈ütirilmemi≈ü</div>
            </div>
        </div>

        <div class="filters">
            <button class="filter-btn active" data-filter="all">T√ºm√º</button>
            <button class="filter-btn" data-filter="matched">E≈üle≈ütirilmi≈ü</button>
            <button class="filter-btn" data-filter="unmatched">E≈üle≈ütirilmemi≈ü</button>
            <button class="filter-btn" onclick="openAddFoodModal()" style="margin-left: auto; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; font-weight: 600;">
                ‚ûï Yeni Yemek Ekle
            </button>
        </div>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="üîç Yemek ara...">
        </div>

        <!-- Sƒ±ralama Kontrolleri -->
        <div class="sort-controls">
            <span>üìä Sƒ±rala:</span>
            <button class="sort-btn" data-sort="calories">üî• Kalori</button>
            <button class="sort-btn" data-sort="protein">ü•© Protein</button>
            <button class="sort-btn" data-sort="carbs">üçû Karb</button>
            <button class="sort-btn" data-sort="fat">üßà Yaƒü</button>
            <button class="sort-btn" data-sort="name">üìù ƒ∞sim</button>
            <button class="sort-btn" onclick="resetSort()">‚Üª Sƒ±fƒ±rla</button>
        </div>

        <div id="foodGrid" class="food-grid">
            <div class="loading">Yemekler y√ºkleniyor...</div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="matchModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">E≈üle≈ütirme Y√∂netimi</h2>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>

            <!-- Tab Buttons -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e9ecef; flex-wrap: wrap;">
                <button class="tab-btn active" onclick="switchTab('manuel')" id="tabManuel">
                    üìù Manuel E≈üle≈ütirme (Tarif Kartlarƒ±)
                </button>
                <button class="tab-btn" onclick="switchTab('yasak')" id="tabYasak">
                    üö´ E≈üle≈üme Yasaklarƒ± (Tarif Kartlarƒ±)
                </button>
                <button class="tab-btn" onclick="switchTab('yemekEslestirme')" id="tabYemekEslestirme">
                    üçΩÔ∏è Yemek Veritabanƒ± E≈üle≈ütirme
                </button>
                <button class="tab-btn" onclick="switchTab('yemekYasak')" id="tabYemekYasak">
                    ‚õî Yemek Veritabanƒ± Yasaklarƒ±
                </button>
            </div>

            <!-- Tab: Manuel E≈üle≈ütirme -->
            <div id="tabContentManuel" class="tab-content active">
                <!-- E≈üle≈üme Bilgileri -->
                <div id="matchInfoPanel" style="display: none; background: #e7f3ff; border: 2px solid #2196F3; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 24px;">‚ÑπÔ∏è</span>
                        <strong style="color: #1976D2; font-size: 16px;">Bu Yemek ≈ûu Kartlarla E≈üle≈ümi≈ü:</strong>
                    </div>
                    <div id="matchInfoContent" style="margin-left: 34px;"></div>
                </div>
                
                <div class="current-match" id="currentMatch" style="display: none; background: #e7f3ff; border: 2px solid #2196F3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üçΩÔ∏è</span>
                        <div>
                            <strong style="color: #1976D2; font-size: 16px;">Se√ßili Yemek:</strong>
                            <div style="color: #333; font-size: 18px; font-weight: bold; margin-top: 5px;" id="currentMatchName"></div>
                            <div style="color: #666; font-size: 13px; margin-top: 5px;">Bu yemek i√ßin tarif kartlarƒ± se√ßin</div>
                        </div>
                    </div>
                </div>

                <!-- Arama Kutusu -->
                <div style="margin-bottom: 15px;">
                    <input type="text" 
                           id="searchTarifManuel" 
                           placeholder="üîç Tarif kartlarƒ±nda ara..." 
                           oninput="filterTarifKartlari()"
                           style="width: 100%; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 14px;">
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <button class="btn" onclick="clearManuelSelection()" style="background: #6c757d; color: white; padding: 6px 15px; font-size: 13px;">
                        üóëÔ∏è Se√ßimi Temizle
                    </button>
                    <span id="selectionCount" style="color: #667eea; font-weight: bold; line-height: 32px;"></span>
                </div>

                <div class="tarif-grid" id="tarifGrid">
                    <div class="loading">Tarif kartlarƒ± y√ºkleniyor...</div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-cancel" onclick="closeModal()">ƒ∞ptal</button>
                    <button class="btn" onclick="deleteManuelMatch(event)" style="background: #dc3545; color: white;" id="btnDeleteManuel">
                        ‚ùå E≈üle≈ütirmeyi Kaldƒ±r
                    </button>
                    <button class="btn btn-save" onclick="saveManuelMatch(event)" id="btnSaveManuel">
                        üíæ Supabase'e Kaydet
                    </button>
                </div>
            </div>

            <!-- Tab: E≈üle≈üme Yasaklarƒ± -->
            <div id="tabContentYasak" class="tab-content" style="display: none;">
                <div class="current-match" id="currentYasak" style="display: none; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üçΩÔ∏è</span>
                        <div>
                            <strong style="color: #856404; font-size: 16px;">Se√ßili Yemek:</strong>
                            <div style="color: #333; font-size: 18px; font-weight: bold; margin-top: 5px;" id="currentYasakName"></div>
                            <div style="color: #666; font-size: 13px; margin-top: 5px;">Bu yemek i√ßin tarif kartƒ± yasaklarƒ± se√ßin</div>
                        </div>
                    </div>
                </div>

                <!-- Arama Kutusu -->
                <div style="margin-bottom: 15px;">
                    <input type="text" 
                           id="searchTarifYasak" 
                           placeholder="üîç Tarif kartlarƒ±nda ara..." 
                           oninput="filterTarifKartlariYasak()"
                           style="width: 100%; padding: 10px; border: 2px solid #dc3545; border-radius: 8px; font-size: 14px;">
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;">
                    <button class="btn" onclick="clearYasakSelection()" style="background: #6c757d; color: white; padding: 6px 15px; font-size: 13px;">
                        üóëÔ∏è Se√ßimi Temizle
                    </button>
                    <span id="yasakCount" style="color: #dc3545; font-weight: bold; line-height: 32px;"></span>
                </div>

                <div class="tarif-grid" id="tarifGridYasak">
                    <div class="loading">Tarif kartlarƒ± y√ºkleniyor...</div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-cancel" onclick="closeModal()">ƒ∞ptal</button>
                    <button class="btn" onclick="deleteYasakMatch(event)" style="background: #6c757d; color: white;" id="btnDeleteYasak">
                        ‚ùå Yasaƒüƒ± Kaldƒ±r
                    </button>
                    <button class="btn" style="background: #dc3545; color: white;" onclick="saveYasakMatch(event)" id="btnSaveYasak">
                        üö´ Yasak Olarak Kaydet
                    </button>
                </div>
            </div>

            <!-- Tab: Yemek Veritabanƒ± E≈üle≈ütirme -->
            <div id="tabContentYemekEslestirme" class="tab-content" style="display: none;">
                <div style="background: #e7f3ff; border: 2px solid #2196F3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 24px;">‚ÑπÔ∏è</span>
                        <strong style="color: #1976D2; font-size: 16px;">Yemek Veritabanƒ± Manuel E≈üle≈ütirme</strong>
                    </div>
                    <p style="margin: 0 0 10px 34px; color: #555; font-size: 14px;">
                        ≈ûablonlardaki yemek adlarƒ±nƒ± Supabase yemek veritabanƒ±ndaki yemeklerle manuel olarak e≈üle≈ütirin.
                    </p>
                    <ul style="margin: 0 0 0 50px; color: #666; font-size: 13px; line-height: 1.8;">
                        <li>"tahin ekmeƒüi (1 dilim)" ‚Üí "Tahin ekmeƒüi" (parantez i√ßi kaldƒ±rƒ±ldƒ±)</li>
                        <li>"ka≈üar peyniri (50g)" ‚Üí "Ka≈üar peyniri" (gram bilgisi kaldƒ±rƒ±ldƒ±)</li>
                        <li>Bu e≈üle≈ütirmeler <code>patient_nutrition.html</code>'de role, dietType, category bilgilerini almak i√ßin kullanƒ±lƒ±r</li>
                    </ul>
                </div>

                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">≈ûablondaki Yemek Adƒ±:</label>
                        <input type="text" 
                               id="yemekEslestirmeArama" 
                               placeholder="√ñrn: tahin ekmeƒüi (1 dilim)"
                               style="width: 100%; padding: 10px; border: 2px solid #2196F3; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="flex: 1; position: relative;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Hedef Yemek (Supabase):</label>
                        <input type="text" 
                               id="yemekEslestirmeHedef" 
                               placeholder="üîç Yemek ara ve se√ß..."
                               autocomplete="off"
                               oninput="filterYemekEslestirmeDropdown(this.value)"
                               onfocus="showYemekEslestirmeDropdown()"
                               style="width: 100%; padding: 10px; border: 2px solid #28a745; border-radius: 8px; font-size: 14px;">
                        <!-- Akƒ±llƒ± dropdown -->
                        <div id="yemekEslestirmeDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 250px; overflow-y: auto; background: white; border: 2px solid #28a745; border-top: none; border-radius: 0 0 8px 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 1000;">
                            <!-- JavaScript ile dolacak -->
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-save" onclick="saveYemekEslestirme()">
                        ‚úÖ E≈üle≈ütirmeyi Ekle
                    </button>
                    <button class="btn btn-cancel" onclick="clearYemekEslestirmeForm()">
                        üóëÔ∏è Formu Temizle
                    </button>
                </div>

                <div style="background: white; border: 2px solid #e9ecef; border-radius: 8px; padding: 15px;">
                    <h3 style="margin-top: 0;">üìã Mevcut E≈üle≈ütirmeler</h3>
                    <div id="yemekEslestirmeList" style="max-height: 400px; overflow-y: auto;">
                        <div class="loading">E≈üle≈ütirmeler y√ºkleniyor...</div>
                    </div>
                </div>
            </div>

            <!-- Tab: Yemek Veritabanƒ± Yasaklarƒ± -->
            <div id="tabContentYemekYasak" class="tab-content" style="display: none;">
                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span>
                        <strong style="color: #856404; font-size: 16px;">Yemek Veritabanƒ± Yasak E≈üle≈ütirmeler</strong>
                    </div>
                    <p style="margin: 0 0 10px 34px; color: #555; font-size: 14px;">
                        ≈ûablonlardaki yemeklerin Supabase yemek veritabanƒ±ndaki hangi yemeklerle e≈üle≈üMEMESƒ∞ gerektiƒüini belirleyin.
                    </p>
                    <ul style="margin: 0 0 0 50px; color: #666; font-size: 13px; line-height: 1.8;">
                        <li>"zeytin" ‚Üí "Zeytinli meze", "Zeytinli salata" üö´ (√ßok genel kelime)</li>
                        <li>"tavuk" ‚Üí "Tavuklu h√ºnkar beƒüendi" üö´ (sadece tavuk arƒ±yoruz)</li>
                        <li>Fuzzy matching yanlƒ±≈ü e≈üle≈ütirmeleri √∂nler</li>
                    </ul>
                </div>

                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Arama Terimi:</label>
                        <input type="text" 
                               id="yemekYasakArama" 
                               placeholder="√ñrn: zeytin"
                               style="width: 100%; padding: 10px; border: 2px solid #ffc107; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">Yasaklƒ± Yemekler (Supabase):</label>
                    <div style="position: relative;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div style="flex: 1; position: relative;">
                                <input type="text" 
                                       id="yemekYasakHedef" 
                                       placeholder="üîç Yemek ara ve se√ß..."
                                       autocomplete="off"
                                       oninput="filterYemekYasakDropdown(this.value)"
                                       onfocus="showYemekYasakDropdown()"
                                       style="width: 100%; padding: 10px; border: 2px solid #dc3545; border-radius: 8px; font-size: 14px;">
                                <!-- Akƒ±llƒ± dropdown -->
                                <div id="yemekYasakDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 250px; overflow-y: auto; background: white; border: 2px solid #dc3545; border-top: none; border-radius: 0 0 8px 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 1000;">
                                    <!-- JavaScript ile dolacak -->
                                </div>
                            </div>
                            <button class="btn" onclick="addYemekYasakItemManual()" style="background: #dc3545; color: white;">
                                ‚ûï Manuel Ekle
                            </button>
                        </div>
                    </div>
                    <div id="yemekYasakItems" style="display: flex; flex-wrap: wrap; gap: 8px; min-height: 50px; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                        <span style="color: #999; font-size: 13px;">Yasaklƒ± yemekleri yukarƒ±dan se√ßin veya arayƒ±n...</span>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">Yasak Nedeni (Opsiyonel):</label>
                    <textarea 
                        id="yemekYasakNeden" 
                        placeholder="√ñrn: Sadece 'zeytin' kelimesi bile≈üik yemeklerle e≈üle≈ümemeli"
                        style="width: 100%; padding: 10px; border: 2px solid #6c757d; border-radius: 8px; font-size: 14px; min-height: 60px; resize: vertical;"></textarea>
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn" onclick="saveYemekYasak()" style="background: #dc3545; color: white;">
                        üö´ Yasaƒüƒ± Ekle
                    </button>
                    <button class="btn btn-cancel" onclick="clearYemekYasakForm()">
                        üóëÔ∏è Formu Temizle
                    </button>
                </div>

                <div style="background: white; border: 2px solid #e9ecef; border-radius: 8px; padding: 15px;">
                    <h3 style="margin-top: 0;">üìã Mevcut Yasaklar</h3>
                    <div id="yemekYasakList" style="max-height: 400px; overflow-y: auto;">
                        <div class="loading">Yasaklar y√ºkleniyor...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ùå GitHub Token Modal KALDIRILDI - Artƒ±k Supabase kullanƒ±lƒ±yor -->

    </div>
    <script>
        // Supabase client zaten head'de ba≈ülatƒ±ldƒ± - CONFIG.SUPABASE_URL ve CONFIG.SUPABASE_ANON_KEY kullanƒ±lƒ±yor
        
        let foodDatabase = [];
        let tarifKartlari = [];
        let manuelEslestirmeler = {};
        let eslesmemeKurallari = {}; // Yasak kurallarƒ± (tarif kartlarƒ±)
        let yemekVeritabaniEslestirme = {}; // Yemek veritabanƒ± e≈üle≈ütirmeleri (YENƒ∞)
        let yemekVeritabaniYasaklar = {}; // Yemek veritabanƒ± yasaklarƒ± (YENƒ∞)
        let currentYemekYasakItems = []; // Ge√ßici yasak liste
        let currentFood = null;
        let selectedTarifler = []; // Manuel e≈üle≈ütirme i√ßin se√ßili tarifler
        let selectedYasaklar = []; // Yasak kurallarƒ± i√ßin se√ßili tarifler
        let currentFilter = 'all';
        let currentTab = 'manuel'; // 'manuel', 'yasak', 'yemekEslestirme', 'yemekYasak'
        let currentSort = null; // Sƒ±ralama: {field: 'calories', direction: 'asc'}
        let editingFood = null; // D√ºzenlenen yemek
        let displayedFoods = []; // G√∂sterilen yemeklerin listesi

        // ‚úÖ T√úM VERƒ∞LER ARTIK SUPABASE'DE (GitHub/JSON kullanƒ±mƒ± kaldƒ±rƒ±ldƒ±)
        
        // ‚ùå closeTokenModal() fonksiyonu kaldƒ±rƒ±ldƒ± - GitHub token modalƒ± kaldƒ±rƒ±ldƒ±

        // ‚úÖ Bildirim g√∂ster
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColors = {
                success: '#28a745',
                error: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è'
            };
            
            notification.style.cssText = `
                background: ${bgColors[type] || bgColors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                min-width: 300px;
                max-width: 500px;
                font-size: 14px;
                font-weight: 500;
                animation: slideIn 0.3s ease-out;
                cursor: pointer;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">${icons[type] || icons.info}</span>
                    <span>${message}</span>
                </div>
            `;
            
            // Tƒ±klayƒ±nca kapat
            notification.onclick = () => notification.remove();
            
            container.appendChild(notification);
            
            // 5 saniye sonra otomatik kapat
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Tab deƒüi≈ütir
        async function switchTab(tab) {
            currentTab = tab;
            
            // Tab butonlarƒ±nƒ± g√ºncelle
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // T√ºm tab content'leri gizle
            document.getElementById('tabContentManuel').style.display = 'none';
            document.getElementById('tabContentYasak').style.display = 'none';
            document.getElementById('tabContentYemekEslestirme').style.display = 'none';
            document.getElementById('tabContentYemekYasak').style.display = 'none';
            
            // Se√ßili tab'ƒ± g√∂ster
            if (tab === 'manuel') {
                document.getElementById('tabManuel').classList.add('active');
                document.getElementById('tabContentManuel').style.display = 'block';
                
                // Se√ßili yemeƒüi g√∂ster
                if (currentFood && currentFood.name) {
                    const currentMatchDiv = document.getElementById('currentMatch');
                    const currentMatchName = document.getElementById('currentMatchName');
                    if (currentMatchDiv && currentMatchName) {
                        currentMatchName.textContent = currentFood.name;
                        currentMatchDiv.style.display = 'block';
                    }
                }
                
                // Tarif kartlarƒ±nƒ± g√∂ster
                displayTarifKartlari();
            } else if (tab === 'yasak') {
                document.getElementById('tabYasak').classList.add('active');
                document.getElementById('tabContentYasak').style.display = 'block';
                
                // Se√ßili yemeƒüi g√∂ster
                if (currentFood && currentFood.name) {
                    const currentYasakDiv = document.getElementById('currentYasak');
                    const currentYasakName = document.getElementById('currentYasakName');
                    if (currentYasakDiv && currentYasakName) {
                        currentYasakName.textContent = currentFood.name;
                        currentYasakDiv.style.display = 'block';
                    }
                }
                
                displayTarifKartlariYasak();
            } else if (tab === 'yemekEslestirme') {
                document.getElementById('tabYemekEslestirme').classList.add('active');
                document.getElementById('tabContentYemekEslestirme').style.display = 'block';
                
                // ‚úÖ TAB 3: Supabase'den en g√ºncel veriyi y√ºkle
                console.log('üîÑ TAB 3 - Yemek DB e≈üle≈ütirmeleri yeniden y√ºkleniyor...');
                await loadYemekVeritabaniEslestirme();
                
                // Se√ßili yemeƒüi otomatik doldur
                if (currentFood && currentFood.name) {
                    document.getElementById('yemekEslestirmeArama').value = currentFood.name;
                }
                
                renderYemekEslestirmeList();
            } else if (tab === 'yemekYasak') {
                document.getElementById('tabYemekYasak').classList.add('active');
                document.getElementById('tabContentYemekYasak').style.display = 'block';
                
                // ‚úÖ TAB 4: Supabase'den en g√ºncel veriyi y√ºkle
                console.log('üîÑ TAB 4 - Yemek DB yasaklarƒ± yeniden y√ºkleniyor...');
                await loadYemekVeritabaniYasaklar();
                
                // Se√ßili yemeƒüi otomatik doldur
                if (currentFood && currentFood.name) {
                    document.getElementById('yemekYasakArama').value = currentFood.name;
                }
                
                renderYemekYasakList();
            }
        }

        // Normalize fonksiyonu
        function normalizeText(str) {
            if (!str) return '';
            return str.toLowerCase()
                .replace(/√ß/g, 'c')
                .replace(/ƒü/g, 'g')
                .replace(/ƒ±/g, 'i')
                .replace(/iÃá/g, 'i')
                .replace(/√∂/g, 'o')
                .replace(/≈ü/g, 's')
                .replace(/√º/g, 'u')
                .replace(/[^a-z0-9]/g, '');
        }

        // Akƒ±llƒ± arama fonksiyonu (fuzzy search)
        function smartSearch(searchTerm, targetText) {
            if (!searchTerm || !targetText) return false;
            
            const search = normalizeText(searchTerm);
            const target = normalizeText(targetText);
            
            // 1. Tam e≈üle≈üme veya i√ßeriyor mu?
            if (target.includes(search)) return true;
            
            // 2. Kelime kelime e≈üle≈üme - HER KELƒ∞ME BA≈ûLANGI√á OLARAK E≈ûLE≈ûMELI (SIRASIZ)
            // ‚ö†Ô∏è √ñNEMLƒ∞: Normalizasyon yapmadan √ñNCE split yap!
            const searchWords = searchTerm.toLowerCase().split(/\s+/).filter(w => w.length > 0);
            if (searchWords.length > 1) {
                // Hedef metni √ñNCE alt √ßizgi ve bo≈üluklara g√∂re par√ßala, SONRA normalize et
                const targetWords = targetText.split(/[_\s]+/).map(w => normalizeText(w));
                
                // Her arama kelimesini normalize et ve kontrol et
                const allWordsFound = searchWords.every(searchWord => {
                    const normalizedSearchWord = normalizeText(searchWord);
                    return targetWords.some(targetWord => targetWord.startsWith(normalizedSearchWord));
                });
                
                if (allWordsFound) return true;
            }
            
            // 3. Ba≈ülangƒ±√ß e≈üle≈ümesi (tek kelime i√ßin)
            if (target.startsWith(search)) return true;
            
            return false;
        }

        // üêõ Test fonksiyonu
        function testSearch() {
            const tests = [
                { search: "lor sal", target: "lor_peyniri_salatasi" },
                { search: "keto ko", target: "keto_kofte" },
                { search: "keto ko", target: "ketojenik_kofte" },
                { search: "keto ko", target: "ketojenik_ispanakli_borek" },
                { search: "tav gu", target: "tavuk_guvec" },
            ];
            
            console.log("=== ARAMA TESTLERƒ∞ ===");
            tests.forEach(test => {
                const result = smartSearch(test.search, test.target);
                const searchWords = normalizeText(test.search).split(/\s+/);
                const targetWords = normalizeText(test.target).split(/[_\s]+/);
                
                console.log(`\n"${test.search}" ‚Üí "${test.target}"`);
                console.log(`  Arama kelimeleri: [${searchWords.join(', ')}]`);
                console.log(`  Hedef kelimeler: [${targetWords.join(', ')}]`);
                console.log(`  Sonu√ß: ${result ? '‚úÖ BULUNDU' : '‚ùå BULUNAMADI'}`);
            });
            
            alert("Test sonu√ßlarƒ± Console'da! (F12 > Console)");
        }

        // Quantity ve parantez temizleme (yemek-alternatif-bulucu-v2.html ile aynƒ±)
        function cleanYemekAdi(yemekAdi) {
            let cleaned = yemekAdi;
            
            // 1. Quantity removal (ba≈ütan) - DETAYLI
            cleaned = cleaned.replace(/^\d+\.\s*/g, ''); // "1. "
            cleaned = cleaned.replace(/^\d+\s*adet\s*/gi, ''); // "1 adet"
            cleaned = cleaned.replace(/^\d+\s*dilim\s*/gi, ''); // "1 dilim"
            cleaned = cleaned.replace(/^\d+\s*gram\s*/gi, ''); // "1 gram"
            cleaned = cleaned.replace(/^\d+\s*gr\.?\s*/gi, ''); // "1 gr"
            cleaned = cleaned.replace(/^\d+\s*ml\s*/gi, ''); // "1 ml"
            cleaned = cleaned.replace(/^\d+\s*porsiyon\s*/gi, ''); // "1 porsiyon"
            cleaned = cleaned.replace(/^\(\s*\d+\s*porsiyon\s*\)\s*/gi, ''); // "(1 porsiyon)"
            
            // ‚úÖ YENƒ∞: Ba≈üƒ±ndaki tek ba≈üƒ±na sayƒ± + birim (tatlƒ± ka≈üƒ±ƒüƒ±, yemek ka≈üƒ±ƒüƒ±, vb.)
            cleaned = cleaned.replace(/^\d+\s+(tatlƒ±|yemek|√ßorba|√ßay)\s+ka≈üƒ±ƒüƒ±\s+/gi, ''); // "1 tatlƒ± ka≈üƒ±ƒüƒ±"
            cleaned = cleaned.replace(/^\d+\s+(su\s+)?bardaƒüƒ±\s+/gi, ''); // "1 bardak", "1 su bardaƒüƒ±"
            cleaned = cleaned.replace(/^\d+\s+/g, ''); // Son √ßare: Ba≈üƒ±ndaki sayƒ±yƒ± sil (eƒüer yukarƒ±dakiler yakalamadƒ±ysa)
            
            // 2. Parantez i√ßindekiler
            cleaned = cleaned.replace(/\([^)]*\)/g, '');
            
            return cleaned.trim();
        }

        // Tarif kartlarƒ±nƒ± bul (yemek-alternatif-bulucu-v2.html mantƒ±ƒüƒ±)
        function findTarifKartlari(yemekAdi) {
            if (!yemekAdi) return { matched: [], sources: [], blocked: false, blockReason: null };
            
            const cleanedYemekAdi = cleanYemekAdi(yemekAdi);
            const normalized = normalizeText(cleanedYemekAdi);
            
            let manuelMatches = [];
            let otomatikMatches = [];
            let sources = [];
            
            // √ñNCE: Manuel e≈üle≈ütirme kontrol√º
            let manuelMatch = manuelEslestirmeler[yemekAdi] || 
                            manuelEslestirmeler[normalized] ||
                            manuelEslestirmeler[cleanedYemekAdi] ||
                            manuelEslestirmeler[normalizeText(yemekAdi)];
            
            if (manuelMatch) {
                if (typeof manuelMatch === 'object' && manuelMatch.kartlar) {
                    manuelMatches = manuelMatch.kartlar;
                } else if (typeof manuelMatch === 'string') {
                    manuelMatches = [manuelMatch];
                }
                
                if (manuelMatches.length > 0) {
                    sources.push('manuel');
                }
            }
            
            // SONRA: Otomatik e≈üle≈ütirme (AKILLI ALGORƒ∞TMA)
            const debugYemek = yemekAdi.includes('Sebzeli Muffin') || yemekAdi.includes('Tatlƒ± Patates');
            if (debugYemek) {
                console.log(`\nüîç OTO E≈ûLE≈ûTƒ∞RME DEBUG: "${yemekAdi}"`);
                console.log(`   - normalized: "${normalized}"`);
                console.log(`   - yemekWords:`, normalized.split('_').filter(w => w.length > 0));
            }
            
            for (const tarif of tarifKartlari) {
                // tarif.name artƒ±k display name (√∂rn: "Fƒ±rƒ±nda Menemen")
                // tarif.file dosya adƒ± (√∂rn: "firinda_menemen.jpg")
                const tarifName = tarif.name || tarif.file?.replace(/\.(jpg|jpeg|png)$/i, '') || '';
                if (!tarifName) continue; // Bo≈ü ise atla
                
                const tarifNormalized = normalizeText(tarifName);
                const tarifWords = tarifNormalized.split('_').filter(w => w.length > 0);
                
                const yemekWords = normalized.split('_').filter(w => w.length > 0);
                
                // Debug i√ßin "sebzeli" veya "muffin" kelimelerini i√ßeren tarifleri g√∂ster
                if (debugYemek && (tarifNormalized.includes('sebzeli') || tarifNormalized.includes('muffin'))) {
                    console.log(`   üìã Tarif: "${tarifName}"`);
                    console.log(`      - tarifNormalized: "${tarifNormalized}"`);
                    console.log(`      - tarifWords:`, tarifWords);
                    console.log(`      - allYemekWordsInTarif:`, yemekWords.every(word => tarifWords.includes(word)));
                    console.log(`      - allTarifWordsInYemek:`, tarifWords.every(word => yemekWords.includes(word)));
                }
                
                // 1. TAM E≈ûLE≈ûME - En y√ºksek √∂ncelik
                if (tarifNormalized === normalized) {
                    otomatikMatches.push(tarif.name);
                    if (debugYemek) console.log(`      ‚úÖ TAM E≈ûLE≈ûME`);
                    continue;
                }
                
                // 2. YEMEK KELƒ∞MELERƒ∞ TARƒ∞F ƒ∞√áƒ∞NDE TAM GE√áƒ∞YOR MU?
                // √ñrnek: "pankek" yemeƒüi i√ßin "pankek.jpg" e≈üle≈üsin ama "karnabahar_pankek.jpg" e≈üle≈ümesin
                // Ancak "karnabahar pankek" yemeƒüi i√ßin "karnabahar_pankek.jpg" e≈üle≈üsin
                
                const allYemekWordsInTarif = yemekWords.every(word => tarifWords.includes(word));
                const allTarifWordsInYemek = tarifWords.every(word => yemekWords.includes(word));
                
                // 3. ƒ∞Kƒ∞ Y√ñNL√ú TAM KELƒ∞ME E≈ûLE≈ûMESƒ∞
                // Yemekteki t√ºm kelimeler tarifteyse VE tarifteki t√ºm kelimeler yemekteyse ‚Üí E≈üle≈ü
                if (allYemekWordsInTarif && allTarifWordsInYemek) {
                    otomatikMatches.push(tarif.name);
                    continue;
                }
                
                // 4. YEMEK = TAM Bƒ∞R KELƒ∞ME (tek kelime yemekler i√ßin)
                // √ñrnek: "pankek" yemeƒüi sadece "pankek.jpg" ile e≈üle≈üsin
                if (yemekWords.length === 1 && tarifWords.length === 1 && yemekWords[0] === tarifWords[0]) {
                    otomatikMatches.push(tarif.name);
                    continue;
                }
                
                // 5. √áOK KELƒ∞MELƒ∞ YEMEKLER ƒ∞√áƒ∞N: Yemekteki t√ºm kelimeler tarifteyse
                // √ñrnek: "kiymali karnabahar" i√ßin "kiymali_karnabahar_pankek.jpg" e≈üle≈üebilir
                // ANCAK tarifte fazladan kelime varsa e≈üle≈üme skoru d√º≈ü√ºk olmalƒ±
                if (yemekWords.length >= 2 && allYemekWordsInTarif) {
                    // Tarifte fazladan kelime yoksa veya sadece 1 fazla kelime varsa e≈üle≈ü
                    const extraWords = tarifWords.length - yemekWords.length;
                    if (extraWords <= 1) {
                        otomatikMatches.push(tarif.name);
                    }
                }
            }
            
            if (otomatikMatches.length > 0) {
                sources.push('otomatik');
            }
            
            // T√ºm e≈üle≈ümeleri source bilgisiyle birlikte hazƒ±rla
            const matchedWithSource = [];
            
            // Manuel e≈üle≈ümeleri ekle
            manuelMatches.forEach(kartAdi => {
                matchedWithSource.push({ name: kartAdi, source: 'manuel' });
            });
            
            // Otomatik e≈üle≈ümeleri ekle (sadece manuel'de yoksa)
            otomatikMatches.forEach(kartAdi => {
                if (!manuelMatches.includes(kartAdi)) {
                    matchedWithSource.push({ name: kartAdi, source: 'otomatik' });
                }
            });
            
            // Yasak kontrol√º
            const allMatchNames = matchedWithSource.map(m => m.name);
            const yasakCheck = checkYasakKurallar(yemekAdi, allMatchNames);
            
            // Yasak kuralƒ± var mƒ± kontrol et (e≈üle≈üme olsun olmasƒ±n)
            const yasakData = getYasakKurallar(yemekAdi);
            
            if (yasakCheck.blocked) {
                return { 
                    matched: [], 
                    sources: [], 
                    blocked: true, 
                    blockReason: yasakCheck.reason, 
                    attempted: allMatchNames,
                    yasakCount: yasakData ? yasakData.length : 0
                };
            }
            
            return { 
                matched: matchedWithSource, 
                sources: sources, 
                blocked: false,
                yasakCount: yasakData ? yasakData.length : 0, // Yasak sayƒ±sƒ±nƒ± her zaman ekle
                // Geriye d√∂n√ºk uyumluluk i√ßin
                source: sources.length > 0 ? sources[0] : 'none'
            };
        }

        // Yasak kurallarƒ± kontrol√º
        function checkYasakKurallar(yemekAdi, tarifKartlari) {
            if (!Array.isArray(tarifKartlari) || tarifKartlari.length === 0) {
                return { blocked: false };
            }
            
            const yasakListesi = getYasakKurallar(yemekAdi);
            if (!yasakListesi || yasakListesi.length === 0) return { blocked: false };
            
            // Her tarif kartƒ±nƒ± yasak listesiyle kar≈üƒ±la≈ütƒ±r
            for (const tarif of tarifKartlari) {
                if (!tarif) continue; // undefined/null kontrol√º
                
                // tarif string veya object olabilir
                const tarifAdi = typeof tarif === 'string' ? tarif : (tarif.name || tarif.file || '');
                if (!tarifAdi) continue;
                
                const tarifNormalized = normalizeText(tarifAdi.replace(/\.(jpg|jpeg|png)$/i, ''));
                
                for (const yasak of yasakListesi) {
                    const yasakNormalized = normalizeText(yasak.replace(/\.(jpg|jpeg|png)$/i, ''));
                    
                    if (tarifNormalized === yasakNormalized || tarifNormalized.includes(yasakNormalized)) {
                        return { 
                            blocked: true, 
                            reason: `"${tarifAdi}" yasak listede: "${yasak}"`,
                            blockedCard: tarifAdi,
                            yasakRule: yasak
                        };
                    }
                }
            }
            
            return { blocked: false };
        }
        
        // Yemek i√ßin yasak kurallarƒ±nƒ± al (helper fonksiyon)
        function getYasakKurallar(yemekAdi) {
            const cleanedYemekAdi = cleanYemekAdi(yemekAdi);
            const normalized = normalizeText(cleanedYemekAdi);
            
            // Bo≈üluklu lowercase version (JSON'daki key formatƒ±) - TEMƒ∞ZLENMƒ∞≈û metinle!
            const lowercaseSpaced = cleanedYemekAdi.toLowerCase()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                .replace(/√ß/g, 'c').replace(/√á/g, 'C')
                .trim();
            
            console.log('üîç getYasakKurallar √ßaƒürƒ±ldƒ±:', {
                orijinal: yemekAdi,
                cleaned: cleanedYemekAdi,
                normalized: normalized,
                lowercaseSpaced: lowercaseSpaced,
                mevcutKeys: Object.keys(eslesmemeKurallari)
            });
            
            // üêõ DEBUG: T√ºm key'leri ve ilk birka√ß deƒüeri g√∂ster
            console.log('üîç eslesmemeKurallari i√ßeriƒüi:', eslesmemeKurallari);
            console.log('üîë Denenen key\'ler:', {
                key1: yemekAdi,
                key2: lowercaseSpaced,
                key3: normalized,
                key4: cleanedYemekAdi,
                key5: normalizeText(yemekAdi)
            });
            
            // Farklƒ± key'leri dene (JSON'daki key'ler bo≈üluklu ve lowercase)
            let yasakData = eslesmemeKurallari[yemekAdi] ||           // Orijinal
                            eslesmemeKurallari[lowercaseSpaced] ||     // Bo≈üluklu lowercase (JSON formatƒ±!)
                            eslesmemeKurallari[normalized] ||          // Alt √ßizgili
                            eslesmemeKurallari[cleanedYemekAdi] ||     // Temizlenmi≈ü
                            eslesmemeKurallari[normalizeText(yemekAdi)]; // Normalize orijinal
            
            console.log('üîç ƒ∞lk deneme sonucu:', yasakData ? '‚úÖ Bulundu' : '‚ùå Bulunamadƒ±');
            
            // Eƒüer bulunamazsa, t√ºm key'leri kontrol et (fuzzy match)
            if (!yasakData) {
                const allKeys = Object.keys(eslesmemeKurallari);
                for (const key of allKeys) {
                    const keyNormalized = normalizeText(key);
                    if (keyNormalized === normalized || 
                        key.toLowerCase() === lowercaseSpaced.toLowerCase()) {
                        yasakData = eslesmemeKurallari[key];
                        console.log(`‚úÖ Fuzzy match: "${yemekAdi}" ‚Üí "${key}"`);
                        break;
                    }
                }
            }
            
            if (!yasakData) return null;
            
            // Yasak listesini al (eski ve yeni format desteƒüi)
            if (Array.isArray(yasakData)) {
                return yasakData;
            } else if (typeof yasakData === 'object' && yasakData.yasakliKartlar) {
                return yasakData.yasakliKartlar;
            }
            
            return null;
        }

        // √ñnizleme panelini toggle
        function togglePreview() {
            const panel = document.getElementById('previewPanel');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                document.getElementById('previewInput').focus();
            }
        }

        // √ñnizlemeyi g√ºncelle
        function updatePreview() {
            const yemekAdi = document.getElementById('previewInput').value.trim();
            const resultsDiv = document.getElementById('previewResults');
            
            if (!yemekAdi) {
                resultsDiv.innerHTML = '<div class="preview-info" style="text-align: center; color: #999;">Bir yemek adƒ± yazƒ±n...</div>';
                return;
            }
            
            const result = findTarifKartlari(yemekAdi);
            const cleanedName = cleanYemekAdi(yemekAdi);
            const normalizedName = normalizeText(cleanedName);
            
            let html = '';
            
            // 1. Temizlenmi≈ü isim bilgisi
            if (cleanedName !== yemekAdi) {
                html += `
                    <div class="preview-section">
                        <h4>üìù Temizlenmi≈ü ƒ∞sim</h4>
                        <div class="preview-info">
                            <strong>Orijinal:</strong> ${yemekAdi}<br>
                            <strong>Temizlenmi≈ü:</strong> ${cleanedName}<br>
                            <strong>Normalize:</strong> ${normalizedName}
                        </div>
                    </div>
                `;
            }
            
            // 2. E≈üle≈ütirme durumu
            html += '<div class="preview-section"><h4>üéØ E≈üle≈ütirme Durumu</h4>';
            
            if (result.blocked) {
                html += `
                    <span class="match-badge yasak">üö´ YASAK KURAL</span>
                    <div class="preview-info">
                        <strong>Kaynak:</strong> ${result.source === 'manuel-blocked' ? 'Manuel E≈üle≈ütirme (Engellendi)' : 'Otomatik E≈üle≈ütirme (Engellendi)'}<br>
                        <strong>Engellenen Kart:</strong> ${result.attempted ? result.attempted.join(', ') : 'N/A'}<br>
                        <strong>Sebep:</strong> ${result.blockReason || 'Yasak listede'}
                    </div>
                `;
            } else if (result.source === 'manuel') {
                html += `
                    <span class="match-badge manuel">üîµ MANUEL E≈ûLE≈ûTIRME</span>
                    <div class="preview-info">
                        <strong>Kaynak:</strong> manuel_eslestirmeler.json<br>
                        <strong>E≈üle≈üen Kart Sayƒ±sƒ±:</strong> ${result.matched.length}
                    </div>
                `;
            } else if (result.source === 'otomatik') {
                html += `
                    <span class="match-badge otomatik">üü¢ OTOMATƒ∞K E≈ûLE≈ûTIRME</span>
                    <div class="preview-info">
                        <strong>Kaynak:</strong> Regex/ƒ∞sim benzerliƒüi<br>
                        <strong>E≈üle≈üen Kart Sayƒ±sƒ±:</strong> ${result.matched.length}
                    </div>
                `;
            } else {
                html += `
                    <span class="match-badge none">‚ùå E≈ûLE≈ûME YOK</span>
                    <div class="preview-info">
                        Hi√ßbir tarif kartƒ± bulunamadƒ±.
                    </div>
                `;
            }
            
            html += '</div>';
            
            // 3. E≈üle≈üen kartlarƒ± g√∂ster
            if (result.matched && result.matched.length > 0) {
                html += '<div class="preview-section"><h4>üé¥ E≈üle≈üen Kartlar</h4><div class="match-cards">';
                
                result.matched.forEach(kartAdi => {
                    const imageUrl = `https://raw.githubusercontent.com/mustafasacar35/lipodem-takip-paneli-2.2/main/tarifler/${kartAdi}`;
                    const displayName = kartAdi.replace(/\.(jpg|jpeg|png)$/i, '');
                    
                    html += `
                        <div class="match-card-preview">
                            <img src="${imageUrl}" alt="${displayName}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22%3E%3Crect fill=%22%23ddd%22 width=%2280%22 height=%2280%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eüì∑%3C/text%3E%3C/svg%3E'">
                            <div class="card-name">${displayName}</div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // 4. Debug bilgileri
            html += `
                <div class="preview-section">
                    <h4>üîç Debug Bilgileri</h4>
                    <div class="preview-info" style="font-size: 11px;">
                        <strong>Manuel E≈üle≈ütirme:</strong> ${Object.keys(manuelEslestirmeler).length} adet<br>
                        <strong>Yasak Kurallar:</strong> ${Object.keys(eslesmemeKurallari).length} adet<br>
                        <strong>Tarif Kartlarƒ±:</strong> ${tarifKartlari.length} adet<br>
                        <strong>Aranan Key'ler:</strong><br>
                        - ${yemekAdi}<br>
                        - ${cleanedName}<br>
                        - ${normalizedName}
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Yemekleri y√ºkle (üî• DAL kullan - Supabase-first)
        async function loadFoodData() {
            try {
                console.log('üì• Yemek veritabanƒ± y√ºkleniyor (DAL)...');
                const data = await window.DAL.getFoodList();
                
                foodDatabase = [];
                if (data.categories && Array.isArray(data.categories)) {
                    data.categories.forEach(category => {
                        if (category.items && Array.isArray(category.items)) {
                            foodDatabase.push(...category.items);
                        }
                    });
                }
                
                console.log('‚úÖ Yemek veritabanƒ± y√ºklendi:', foodDatabase.length, 'yemek');
                
                await loadTarifKartlari();
                await loadManuelEslestirmeler();
                await loadEslesmemeKurallari();
                await loadYemekVeritabaniEslestirme();
                await loadYemekVeritabaniYasaklar();
                
                displayFoods();
            } catch (error) {
                console.error('‚ùå Veritabanƒ± hatasƒ±:', error);
                document.getElementById('foodGrid').innerHTML = '<div class="loading">‚ùå Veritabanƒ± y√ºklenemedi</div>';
            }
        }

        // Tarif kartlarƒ±nƒ± y√ºkle
        async function loadTarifKartlari() {
            try {
                console.log('üì• Tarif kartlarƒ± y√ºkleniyor (DAL)...');
                
                // DAL kullanarak Supabase-first y√ºkleme
                const recipeCards = await window.DAL.getRecipeCards();
                
                // Array kontrol√º ve format tespiti
                if (Array.isArray(recipeCards) && recipeCards.length > 0) {
                    // DAL.getRecipeCards() artƒ±k object array d√∂nd√ºr√ºyor: {id, name, file, filename, ...}
                    // name = display_name (√∂rn: "Fƒ±rƒ±nda Menemen")
                    // file/filename = dosya adƒ± (√∂rn: "firinda_menemen.jpg")
                    tarifKartlari = recipeCards.map(card => ({
                        name: card.name || card.display_name,  // Display name (tarif adƒ±)
                        file: card.file || card.filename,       // Dosya adƒ±
                        type: 'file',
                        download_url: card.download_url
                    }));
                    
                    console.log('‚úÖ Tarif kartlarƒ± y√ºklendi (DAL):', tarifKartlari.length, 'kart');
                    return;
                }
                
                throw new Error('Recipe cards array bulunamadƒ±');
                
            } catch (error) {
                console.error('‚ùå Tarif kartlarƒ± y√ºklenemedi:', error.message);
                
                // FALLBACK: Manuel e≈üle≈ütirmelerden tarif listesini √ßƒ±kar
                console.log('üì¶ Fallback: Manuel e≈üle≈ütirmelerden tarif listesi olu≈üturuluyor...');
                
                // Manuel e≈üle≈ütirmeleri bekle
                if (Object.keys(manuelEslestirmeler).length === 0) {
                    await loadManuelEslestirmeler();
                }
                
                // Manuel e≈üle≈ütirmelerdeki t√ºm kartlarƒ± topla
                const uniqueTarifler = new Set();
                Object.values(manuelEslestirmeler).forEach(eslestirme => {
                    if (eslestirme && typeof eslestirme === 'object' && eslestirme.kartlar) {
                        eslestirme.kartlar.forEach(kart => uniqueTarifler.add(kart));
                    } else if (typeof eslestirme === 'string') {
                        uniqueTarifler.add(eslestirme);
                    }
                });
                
                tarifKartlari = [...uniqueTarifler].map(name => ({
                    name: name,
                    type: 'file',
                    download_url: `https://raw.githubusercontent.com/mustafasacar35/lipodem-takip-paneli-2.2/main/tarifler/${name}`
                }));
                
                console.log('‚úÖ Fallback tarif kartlarƒ± y√ºklendi:', tarifKartlari.length, 'kart (manuel e≈üle≈ütirmelerden)');
            }
        }

        // Manuel e≈üle≈ütirmeleri y√ºkle (SADECE SUPABASE)
        async function loadManuelEslestirmeler() {
            try {
                console.log('üì• Manuel e≈üle≈ütirmeler Supabase\'den y√ºkleniyor...');
                
                // DAL ile Supabase'den √ßek
                if (!window.DAL) {
                    throw new Error('DAL bulunamadƒ±! L√ºtfen sayfayƒ± yenileyin.');
                }
                
                const matchingsArray = await window.DAL.getFoodMatchings();
                
                console.log('üì¶ Supabase\'den gelen RAW veri (array):', matchingsArray);
                console.log('ÔøΩ Toplam satƒ±r sayƒ±sƒ±:', matchingsArray.length);
                
                // Her satƒ±rƒ± detaylƒ± g√∂ster
                console.group('üîç DETAYLI VERƒ∞ ANALƒ∞Zƒ∞');
                matchingsArray.forEach((item, index) => {
                    console.log(`\n${index + 1}. Satƒ±r:`);
                    console.log('  - food_name:', item.food_name);
                    console.log('  - matched_food:', item.matched_food);
                    console.log('  - normalize(food_name):', normalizeText(item.food_name));
                    console.log('  - created_at:', item.created_at);
                });
                console.groupEnd();
                
                // √ñzel kontrol: "Ketojenik K√∂fte" e≈üle≈ütirmeleri
                const ketojenikMatches = matchingsArray.filter(m => 
                    m.food_name.toLowerCase().includes('ketojenik') || 
                    m.food_name.toLowerCase().includes('k√∂fte')
                );
                console.log('\nüçñ "Ketojenik K√∂fte" ile ilgili satƒ±rlar:', ketojenikMatches);
                
                // Array'i objeye √ßevir (eski format) - DUPLIKE √ñNLEME
                manuelEslestirmeler = {};
                matchingsArray.forEach(item => {
                    // Key'i normalizeText ile olu≈ütur (T√ºrk√ße karakterler d√ºzeltilmi≈ü)
                    const key = normalizeText(item.food_name);
                    if (!manuelEslestirmeler[key]) {
                        manuelEslestirmeler[key] = {
                            orijinalMetin: item.food_name,
                            kartlar: [],
                            eklemeTarihi: item.created_at
                        };
                    }
                    
                    // üî• SADECE DOSYA ADI FORMATINI KABUL ET (.jpg dahil)
                    // Eƒüer eski format gelirse (.jpg yoksa) normalize et
                    let normalizedFile = item.matched_food;
                    if (!item.matched_food.match(/\.(jpg|jpeg|png)$/i)) {
                        // Eski format: "Keto kofte" ‚Üí "keto_kofte.jpg"
                        normalizedFile = item.matched_food.toLowerCase()
                            .replace(/\s+/g, '_')
                            .replace(/[^\w_]/g, '') + '.jpg';
                        console.warn(`‚ö†Ô∏è Eski format tespit edildi ve normalize edildi: "${item.matched_food}" ‚Üí "${normalizedFile}"`);
                    }
                    
                    // Duplike kontrol√º ile ekle
                    if (!manuelEslestirmeler[key].kartlar.includes(normalizedFile)) {
                        manuelEslestirmeler[key].kartlar.push(normalizedFile);
                    } else {
                        console.warn(`‚ö†Ô∏è Duplike atlandƒ±: ${item.food_name} ‚Üí ${normalizedFile}`);
                    }
                });
                
                console.log('\n‚úÖ Manuel e≈üle≈ütirmeler y√ºklendi:', Object.keys(manuelEslestirmeler).length, 'adet');
                console.log('üîë Manuel e≈üle≈ütirme key\'leri:', Object.keys(manuelEslestirmeler));
                
                // "ketojenikkofte" key'inin i√ßeriƒüini g√∂ster
                if (manuelEslestirmeler['ketojenikkofte']) {
                    console.log('\nüéØ "ketojenikkofte" key i√ßeriƒüi:');
                    console.log('  - Orijinal metin:', manuelEslestirmeler['ketojenikkofte'].orijinalMetin);
                    console.log('  - Kartlar:', manuelEslestirmeler['ketojenikkofte'].kartlar);
                    console.log('  - Kart sayƒ±sƒ±:', manuelEslestirmeler['ketojenikkofte'].kartlar.length);
                } else {
                    console.warn('‚ö†Ô∏è "ketojenikkofte" key\'i bulunamadƒ±!');
                }
                
                console.log('\nüìã T√ºm manuel e≈üle≈ütirme detaylarƒ±:', manuelEslestirmeler);
            } catch (error) {
                console.error('‚ùå Manuel e≈üle≈ütirmeler y√ºklenemedi:', error);
                alert('Manuel e≈üle≈ütirmeler y√ºklenirken hata olu≈ütu!');
            }
        }

        // Yasak kurallarƒ±nƒ± y√ºkle (SADECE SUPABASE)
        async function loadEslesmemeKurallari() {
            try {
                console.log('üì• Yasak kurallar Supabase\'den y√ºkleniyor...');
                
                // DAL ile Supabase'den √ßek
                if (!window.DAL) {
                    throw new Error('DAL bulunamadƒ±! L√ºtfen sayfayƒ± yenileyin.');
                }
                
                // üî• patient_nutrition ile aynƒ± y√∂ntemi kullan
                const yasakData = await window.DAL.getFoodBlacklist();
                
                if (yasakData && Object.keys(yasakData).length > 0) {
                    eslesmemeKurallari = yasakData;
                    
                    // üî• ESKI FORMAT NORMALƒ∞ZASYONU (dosya adƒ± formatƒ±na √ßevir)
                    Object.keys(eslesmemeKurallari).forEach(key => {
                        const yasaklar = eslesmemeKurallari[key];
                        if (yasaklar && yasaklar.yasakliKartlar) {
                            eslesmemeKurallari[key].yasakliKartlar = yasaklar.yasakliKartlar.map(cardFile => {
                                // Eƒüer .jpg yoksa ekle
                                if (!cardFile.match(/\.(jpg|jpeg|png)$/i)) {
                                    const normalized = cardFile.toLowerCase()
                                        .replace(/\s+/g, '_')
                                        .replace(/[^\w_]/g, '') + '.jpg';
                                    console.warn(`‚ö†Ô∏è Yasak kart eski format normalize edildi: "${cardFile}" ‚Üí "${normalized}"`);
                                    return normalized;
                                }
                                return cardFile;
                            });
                        }
                    });
                    
                    console.log('‚úÖ Yasak kurallar y√ºklendi:', Object.keys(eslesmemeKurallari).length, 'adet');
                } else {
                    eslesmemeKurallari = {};
                    console.log('‚ö†Ô∏è Yasak kurallar bulunamadƒ±, bo≈ü ba≈ülatƒ±ldƒ±');
                }
            } catch (error) {
                console.error('‚ùå Yasak kurallar y√ºklenemedi:', error);
                eslesmemeKurallari = {};
            }
        }

        // Yemek veritabanƒ± e≈üle≈ütirmelerini y√ºkle (SADECE SUPABASE)
        async function loadYemekVeritabaniEslestirme() {
            try {
                console.log('üì• Yemek veritabanƒ± e≈üle≈ütirmeleri Supabase\'den y√ºkleniyor...');
                
                // DAL ile Supabase'den √ßek
                if (!window.DAL) {
                    throw new Error('DAL bulunamadƒ±! L√ºtfen sayfayƒ± yenileyin.');
                }
                
                const mappingObj = await window.DAL.getFoodDatabaseMappings();
                yemekVeritabaniEslestirme = mappingObj;
                
                console.log('‚úÖ Yemek veritabanƒ± e≈üle≈ütirmeleri y√ºklendi:', Object.keys(yemekVeritabaniEslestirme).length, 'adet');
            } catch (error) {
                console.error('‚ùå Yemek veritabanƒ± e≈üle≈ütirmeleri y√ºklenemedi:', error);
                yemekVeritabaniEslestirme = {};
            }
        }

        // Yemek veritabanƒ± yasaklarƒ± y√ºkle (SADECE SUPABASE)
        async function loadYemekVeritabaniYasaklar() {
            try {
                console.log('üì• Yemek veritabanƒ± yasaklarƒ± Supabase\'den y√ºkleniyor...');
                
                // DAL ile Supabase'den √ßek
                if (!window.DAL) {
                    throw new Error('DAL bulunamadƒ±! L√ºtfen sayfayƒ± yenileyin.');
                }
                
                const data = await window.DAL.getFoodDatabaseProhibitions();
                yemekVeritabaniYasaklar = data.yasaklar || data;
                
                console.log('‚úÖ Yemek veritabanƒ± yasaklarƒ± y√ºklendi:', Object.keys(yemekVeritabaniYasaklar).length, 'adet');
            } catch (error) {
                console.error('‚ùå Yemek veritabanƒ± yasaklarƒ± y√ºklenemedi:', error);
                yemekVeritabaniYasaklar = {};
            }
        }

        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            const totalCount = foodDatabase.length;
            const matchedCount = foodDatabase.filter(food => {
                const matchResult = findTarifKartlari(food.name);
                return matchResult.matched.length > 0;
            }).length;
            
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('matchedCount').textContent = matchedCount;
            document.getElementById('unmatchedCount').textContent = totalCount - matchedCount;
        }

        // üîß Food list'i Supabase'e kaydet (SADECE SUPABASE - GitHub kaldƒ±rƒ±ldƒ±)
        async function saveFoodListToSupabase(updatedDatabase, commitMessage) {
            try {
                if (!window.DAL) {
                    throw new Error('DAL bulunamadƒ±! L√ºtfen sayfayƒ± yenileyin.');
                }
                
                // Kategorilere g√∂re grupla (orijinal format)
                const categories = {};
                
                updatedDatabase.forEach(food => {
                    const categoryName = food.category || 'Diƒüer';
                    if (!categories[categoryName]) {
                        categories[categoryName] = {
                            name: categoryName,
                            items: []
                        };
                    }
                    categories[categoryName].items.push(food);
                });

                const jsonData = {
                    version: "3.0",
                    lastUpdated: new Date().toISOString(),
                    categories: Object.values(categories)
                };
                
                console.log(`üìä Toplam kategori: ${jsonData.categories.length}, Toplam yemek: ${updatedDatabase.length}`);
                console.log(`üíæ Supabase'e kaydediliyor: ${commitMessage}`);
                
                await window.DAL.updateFoodList(jsonData);
                console.log('‚úÖ Food list Supabase\'e kaydedildi');
                
                return true;
            } catch (error) {
                console.error('‚ùå Food list Supabase kayƒ±t hatasƒ±:', error);
                throw error;
            }
        }
        
        // ‚ùå ESKI FONKSƒ∞YON - Geriye d√∂n√ºk uyumluluk i√ßin bƒ±rakƒ±ldƒ±
        async function saveFoodListToGithub(updatedDatabase, commitMessage) {
            return await saveFoodListToSupabase(updatedDatabase, commitMessage);
        }

        // ‚ùå ESKI FONKSƒ∞YONLAR - ARTIK KULLANILMIYOR (DAL kullanƒ±lƒ±yor)
        // saveManuelMatchingsToSupabase, saveFoodBlacklistToSupabase, 
        // saveFoodDatabaseMappingsToSupabase, saveFoodDatabaseProhibitionsToSupabase
        // Bu fonksiyonlar artƒ±k DAL.update* metodlarƒ± ile deƒüi≈ütirildi

        // Yemekleri g√∂ster
        function displayFoods() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filteredFoods = foodDatabase.filter(food => {
                const matchSearch = !searchTerm || food.name.toLowerCase().includes(searchTerm);
                
                // T√ºm e≈üle≈ütirme t√ºrlerini kontrol et (manuel + otomatik)
                const matchResult = findTarifKartlari(food.name);
                const hasMatch = matchResult.matched.length > 0;
                
                if (currentFilter === 'matched') return matchSearch && hasMatch;
                if (currentFilter === 'unmatched') return matchSearch && !hasMatch;
                return matchSearch;
            });

            // G√∂sterilen yemekleri kaydet (sƒ±ralama i√ßin)
            displayedFoods = [...filteredFoods];

            // Eƒüer sƒ±ralama aktifse, yeniden sƒ±rala
            if (currentSort) {
                displayedFoods.sort((a, b) => {
                    let aVal, bVal;

                    if (currentSort.field === 'name') {
                        aVal = a.name.toLowerCase();
                        bVal = b.name.toLowerCase();
                    } else {
                        aVal = a[currentSort.field] || 0;
                        bVal = b[currentSort.field] || 0;
                    }

                    if (currentSort.direction === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });
                filteredFoods = displayedFoods;
            }

            // ƒ∞statistikleri g√ºncelle
            updateStats();

            const grid = document.getElementById('foodGrid');
            if (filteredFoods.length === 0) {
                grid.innerHTML = '<div class="loading">Sonu√ß bulunamadƒ±</div>';
                return;
            }

            grid.innerHTML = filteredFoods.map((food, index) => {
                // T√ºm e≈üle≈ütirme t√ºrlerini kontrol et
                const matchResult = findTarifKartlari(food.name);
                const hasMatch = matchResult.matched.length > 0;
                const matchClass = hasMatch ? 'matched' : '';
                
                // üêõ DEBUG: E≈üle≈ütirme rozetlerini kontrol et
                if (food.name.includes('Tatlƒ± Patates') || food.name.includes('Yaban Mersinli')) {
                    console.log(`üîç ${food.name} ‚Üí matchResult:`, matchResult);
                    console.log(`   - sources:`, matchResult.sources);
                    console.log(`   - matched:`, matchResult.matched);
                }
                
                // üêõ DEBUG: Her yemek i√ßin yasak kontrol√º
                const yasakTest = getYasakKurallar(food.name);
                if (yasakTest) {
                    console.log(`‚úÖ YASAK BULUNDU: "${food.name}" ‚Üí ${yasakTest.length} kart`, yasakTest);
                }
                
                // Debug: Yasak sayƒ±sƒ±nƒ± kontrol et
                if (matchResult.yasakCount > 0) {
                    console.log(`üîç ${food.name} ‚Üí Yasak Count: ${matchResult.yasakCount}`, matchResult);
                }
                
                // E≈üle≈ütirme rozetlerini hazƒ±rla - saƒü alt k√∂≈üe i√ßin
                let matchBadges = '';
                if (matchResult.sources && matchResult.sources.length > 0) {
                    const badges = [];
                    
                    // Manuel e≈üle≈üme sayƒ±sƒ±nƒ± hesapla
                    if (matchResult.sources.includes('manuel')) {
                        const manuelCount = matchResult.matched.filter(m => m.source === 'manuel').length;
                        badges.push(`<span style="background: #007bff; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px; font-weight: bold;">üîµ MANUEL ${manuelCount}</span>`);
                    }
                    
                    // Otomatik e≈üle≈üme sayƒ±sƒ±nƒ± hesapla
                    if (matchResult.sources.includes('otomatik')) {
                        const otoCount = matchResult.matched.filter(m => m.source === 'otomatik').length;
                        badges.push(`<span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px; font-weight: bold;">üü¢ OTO ${otoCount}</span>`);
                    }
                    
                    matchBadges = badges.join(' ');
                }
                
                // Yasak rozetini g√∂ster (e≈üle≈üme engellenmi≈üse VEYA yasak kural varsa)
                if (matchResult.blocked && matchResult.yasakCount > 0) {
                    // T√ºm e≈üle≈ümeler yasaklanmƒ±≈ü
                    matchBadges = `<span onclick="event.stopPropagation(); openYasakModalFromBadge(this.closest('.food-card'))" style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px; font-weight: bold; cursor: pointer;">üö´ YASAK ${matchResult.yasakCount}</span>`;
                } else if (!matchResult.blocked && matchResult.yasakCount > 0) {
                    // Yasak kural var ama e≈üle≈üme engellenmiyor (yasak liste e≈üle≈ümemi≈ü)
                    const yasakBadge = `<span onclick="event.stopPropagation(); openYasakModalFromBadge(this.closest('.food-card'))" style="background: #ffc107; color: black; padding: 2px 6px; border-radius: 10px; font-size: 9px; font-weight: bold; cursor: pointer;">‚ö†Ô∏è YASAK ${matchResult.yasakCount}</span>`;
                    matchBadges = matchBadges ? `${matchBadges} ${yasakBadge}` : yasakBadge;
                }
                
                // Food objesini g√ºvenli ≈üekilde encode et
                const foodData = btoa(encodeURIComponent(JSON.stringify(food)));
                
                // Makro bilgilerini hazƒ±rla - tek satƒ±rda
                const macrosHTML = `
                    <div class="food-macros-inline" style="font-size: 10px; color: #555; margin-top: 6px; padding: 4px 6px; background: rgba(255,255,255,0.9); border-radius: 4px; border: 1px solid #e0e0e0;">
                        <div style="display: flex; justify-content: space-around; gap: 8px; align-items: center;">
                            <span title="Kalori" style="font-weight: 600;">üî•${Math.round(food.calories || 0)}</span>
                            <span title="Karbonhidrat" style="font-weight: 600;">üçû${Math.round(food.carbs || 0)}g</span>
                            <span title="Protein" style="font-weight: 600;">ü•©${Math.round(food.protein || 0)}g</span>
                            <span title="Yaƒü" style="font-weight: 600;">üßà${Math.round(food.fat || 0)}g</span>
                        </div>
                    </div>
                `;
                
                return `
                    <div class="food-card ${matchClass}" data-food="${foodData}">
                        <div style="cursor: pointer;" onclick="openMatchModalFromCard(this.closest('.food-card'))">
                            <div class="food-name">${food.name}</div>
                            ${macrosHTML}
                            <div class="food-meta" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 4px;">
                                <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                    ${food.category ? `<span class="meta-tag">üìÇ ${food.category}</span>` : ''}
                                    ${food.mealType ? `<span class="meta-tag">üçΩÔ∏è ${food.mealType}</span>` : ''}
                                    ${food.keto ? '<span class="meta-tag">ü•ó Keto</span>' : food.lowcarb ? '<span class="meta-tag">ü•ó LowCarb</span>' : ''}
                                </div>
                                <div style="display: flex; gap: 4px; margin-left: auto;">
                                    ${matchBadges}
                                </div>
                            </div>
                        </div>
                        <div class="food-card-actions">
                            <button class="action-btn edit-btn" onclick="event.stopPropagation(); openEditModalFromCard(this.closest('.food-card'))" title="D√ºzenle">
                                ‚úèÔ∏è
                            </button>
                            <button class="action-btn delete-btn" onclick="event.stopPropagation(); deleteFoodFromCard(this.closest('.food-card'))" title="Sil">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Kart √ºzerinden modal a√ß (data attribute'dan)
        function openMatchModalFromCard(element) {
            try {
                const foodData = element.getAttribute('data-food');
                const food = JSON.parse(decodeURIComponent(atob(foodData)));
                openMatchModal(food);
            } catch (error) {
                console.error('Food data parse hatasƒ±:', error);
                alert('Bir hata olu≈ütu. L√ºtfen sayfayƒ± yenileyin.');
            }
        }

        // Yasak badge'e tƒ±klayƒ±nca yasak sekmesini a√ß
        function openYasakModalFromBadge(element) {
            try {
                const foodData = element.getAttribute('data-food');
                const food = JSON.parse(decodeURIComponent(atob(foodData)));
                openMatchModal(food);
                // Yasak sekmesine ge√ß
                switchTab('yasak');
            } catch (error) {
                console.error('Food data parse hatasƒ±:', error);
                alert('Bir hata olu≈ütu. L√ºtfen sayfayƒ± yenileyin.');
            }
        }

        // Modal a√ß
        async function openMatchModal(food) {
            // ‚úÖ ƒ∞lk √∂nce array'leri sƒ±fƒ±rla - mevcut e≈üle≈ümeler sonradan eklenecek
            selectedTarifler = [];
            selectedYasaklar = [];
            
            currentFood = food;
            
            // üî• MODAL A√áILIRKEN EN G√úNCEL VERƒ∞Yƒ∞ √áEK (4 TAB i√ßin de)
            console.log('üîÑ Modal a√ßƒ±lƒ±yor, Supabase\'den g√ºncel veriler √ßekiliyor (4 TAB)...');
            await Promise.all([
                loadManuelEslestirmeler(),       // TAB 1: Manuel E≈üle≈ütirme
                loadEslesmemeKurallari(),         // TAB 2: Yasak Kurallarƒ±
                loadYemekVeritabaniEslestirme(),  // TAB 3: Yemek DB E≈üle≈ütirme
                loadYemekVeritabaniYasaklar()     // TAB 4: Yemek DB Yasaklarƒ±
            ]);
            
            document.getElementById('modalTitle').textContent = `E≈üle≈ütirme: ${food.name}`;
            document.getElementById('matchModal').classList.add('active');
            
            // Varsayƒ±lan olarak manuel e≈üle≈ütirme tabƒ±nƒ± a√ß
            switchTab('manuel');
            
            // T√úM e≈üle≈ümeleri kontrol et ve g√∂ster
            const matchResult = findTarifKartlari(food.name);
            const matchInfoPanel = document.getElementById('matchInfoPanel');
            const matchInfoContent = document.getElementById('matchInfoContent');
            
            if (matchResult.matched.length > 0) {
                let infoHTML = '<ul style="margin: 5px 0; padding-left: 20px;">';
                
                // Manuel e≈üle≈ümeleri g√∂ster
                const manuelMatches = matchResult.matched.filter(m => m.source === 'manuel');
                if (manuelMatches.length > 0) {
                    infoHTML += '<li><span style="background: #007bff; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: bold;">üîµ MANUEL</span> ';
                    infoHTML += manuelMatches.map(m => m.name.replace(/\.(jpg|jpeg|png)$/i, '')).join(', ') + '</li>';
                }
                
                // Otomatik e≈üle≈ümeleri g√∂ster
                const otoMatches = matchResult.matched.filter(m => m.source === 'otomatik');
                if (otoMatches.length > 0) {
                    infoHTML += '<li><span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: bold;">üü¢ OTOMATƒ∞K</span> ';
                    infoHTML += otoMatches.map(m => m.name.replace(/\.(jpg|jpeg|png)$/i, '')).join(', ') + '</li>';
                }
                
                if (matchResult.blocked) {
                    infoHTML += '<li><span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: bold;">üö´ YASAK</span> ';
                    const yasakKey = Object.keys(eslesmemeKurallari).find(key => normalizeText(key) === normalizeText(food.name));
                    if (yasakKey && eslesmemeKurallari[yasakKey]) {
                        const yasakData = eslesmemeKurallari[yasakKey];
                        const yasaklar = yasakData.yasakliKartlar || [];
                        infoHTML += yasaklar.map(y => y.replace(/\.(jpg|jpeg|png)$/i, '')).join(', ') + '</li>';
                    }
                }
                
                infoHTML += '</ul>';
                matchInfoContent.innerHTML = infoHTML;
                matchInfoPanel.style.display = 'block';
            } else {
                matchInfoPanel.style.display = 'none';
            }
            
            // üî• √ñNCELƒ∞KLE: Duplike √∂nlemek i√ßin Set kullan
            const uniqueSelected = new Map(); // file/name ‚Üí tarif objesi
            
            // Mevcut e≈üle≈ütirmeleri (MANUEL veya OTOMATƒ∞K) selectedTarifler'e ekle
            if (matchResult.matched.length > 0) {
                console.log('üéØ E≈üle≈ümeler bulundu, selectedTarifler\'e ekleniyor:', matchResult.matched);
                matchResult.matched.forEach(match => {
                    const name = match.name || match; // Geriye d√∂n√ºk uyumluluk
                    const tarif = tarifKartlari.find(t => {
                        const tNameRaw = t.name || t.file || '';
                        if (!tNameRaw || !name) return false;
                        
                        // Extension'ƒ± kaldƒ±r √ñNCE
                        const tName = tNameRaw.replace(/\.(jpg|jpeg|png)$/i, '');
                        const searchName = name.replace(/\.(jpg|jpeg|png)$/i, '');
                        
                        // Normalize kar≈üƒ±la≈ütƒ±rma (en g√º√ßl√º e≈üle≈üme)
                        if (normalizeText(tName) === normalizeText(searchName)) return true;
                        
                        // Direkt e≈üle≈üme
                        if (tName === searchName) return true;
                        if (tName.toLowerCase() === searchName.toLowerCase()) return true;
                        
                        return false;
                    });
                    if (tarif) {
                        const key = tarif.name || tarif.file;
                        if (!uniqueSelected.has(key)) {
                            uniqueSelected.set(key, tarif);
                            console.log('‚úÖ Tarif bulundu ve eklendi:', key);
                        } else {
                            console.log('‚ö†Ô∏è Zaten ekli, atlanƒ±yor:', key);
                        }
                    } else {
                        console.log('‚ùå Tarif bulunamadƒ±:', name);
                    }
                });
            } else {
                console.log('‚ö†Ô∏è Hi√ß e≈üle≈üme bulunamadƒ±');
            }
            
            // Manuel e≈üle≈ütirme bilgisi g√∂ster
            const normalized = normalizeText(food.name);
            let currentMatchData = manuelEslestirmeler[food.name] || 
                                   manuelEslestirmeler[normalized] ||
                                   manuelEslestirmeler[Object.keys(manuelEslestirmeler).find(key => normalizeText(key) === normalized)];
            
            console.log('üîç Manuel e≈üle≈ütirme aramasƒ±:', {
                foodName: food.name,
                normalized: normalized,
                foundKey: Object.keys(manuelEslestirmeler).find(key => normalizeText(key) === normalized),
                currentMatchData: currentMatchData,
                allKeys: Object.keys(manuelEslestirmeler)
            });
            
            if (currentMatchData) {
                let matchNames = [];
                if (typeof currentMatchData === 'object' && currentMatchData.kartlar) {
                    matchNames = currentMatchData.kartlar;
                } else if (typeof currentMatchData === 'string') {
                    matchNames = [currentMatchData];
                }
                
                console.log('üìã Bulunan e≈üle≈ütirmeler:', matchNames);
                
                // Manuel e≈üle≈ütirmeleri uniqueSelected Map'e ekle (duplike √∂nlenir)
                matchNames.forEach(name => {
                    // Debug: "keto" veya "kofte" i√ßeren t√ºm kartlarƒ± g√∂ster
                    if (name.toLowerCase().includes('keto') || name.toLowerCase().includes('kofte')) {
                        const ketoCards = tarifKartlari.filter(t => {
                            const tName = (t.name || t.file || '').toLowerCase();
                            return tName.includes('keto') || tName.includes('kofte');
                        });
                        console.log('üîç tarifKartlari i√ßinde "keto/kofte" i√ßeren kartlar:', ketoCards.map(t => ({
                            name: t.name,
                            file: t.file,
                            normalized: normalizeText(t.name || t.file || '')
                        })));
                        console.log('üîç Aranan normalized:', normalizeText(name));
                    }
                    
                    const tarif = tarifKartlari.find(t => {
                        const tNameRaw = t.name || t.file || '';
                        if (!tNameRaw || !name) return false;
                        
                        // Extension'ƒ± kaldƒ±r √ñNCE
                        const tName = tNameRaw.replace(/\.(jpg|jpeg|png)$/i, '');
                        const searchName = name.replace(/\.(jpg|jpeg|png)$/i, '');
                        
                        // Normalize kar≈üƒ±la≈ütƒ±rma (en g√º√ßl√º e≈üle≈üme)
                        if (normalizeText(tName) === normalizeText(searchName)) return true;
                        
                        // Direkt e≈üle≈üme
                        if (tName === searchName) return true;
                        if (tName.toLowerCase() === searchName.toLowerCase()) return true;
                        
                        return false;
                    });
                    console.log('üîé Kart aranƒ±yor:', name, '‚Üí Bulundu:', tarif ? (tarif.name || tarif.file) : 'BULUNAMADI');
                    if (tarif) {
                        const key = tarif.name || tarif.file;
                        if (!uniqueSelected.has(key)) {
                            uniqueSelected.set(key, tarif);
                            console.log('‚ûï Manuel e≈üle≈ütirme eklendi:', key);
                        } else {
                            console.log('‚ö†Ô∏è Manuel e≈üle≈ütirme zaten mevcut, atlanƒ±yor:', key);
                        }
                    }
                });
                
                document.getElementById('currentMatch').style.display = 'block';
                document.getElementById('currentMatchName').textContent = matchNames.map(n => n.replace(/\.(jpg|jpeg|png)$/i, '')).join(', ');
            } else {
                document.getElementById('currentMatch').style.display = 'none';
            }
            
            // üî• Map'i Array'e √ßevir ve selectedTarifler'e ata
            selectedTarifler = Array.from(uniqueSelected.values());
            console.log('üì¶ Final selectedTarifler (duplikesiz):', selectedTarifler.map(t => t.name || t.file));
            
            displayTarifKartlari();
        }

        // Tarif kartlarƒ±nƒ± modal'da g√∂ster
        function displayTarifKartlari(filteredList = null) {
            const grid = document.getElementById('tarifGrid');
            const searchTerm = document.getElementById('searchTarifManuel')?.value.toLowerCase() || '';
            
            if (tarifKartlari.length === 0) {
                grid.innerHTML = '<div class="loading">Tarif kartƒ± bulunamadƒ±</div>';
                return;
            }

            // ‚ú® 1. SE√áƒ∞Lƒ∞ KARTLARI AYIR (her zaman g√∂sterilecek)
            const selectedCards = selectedTarifler.slice();
            
            // ‚ú® 2. SE√áƒ∞Lƒ∞ OLMAYAN KARTLARI Fƒ∞LTRELE
            let unselectedCards = (filteredList || tarifKartlari).filter(tarif => 
                !selectedTarifler.some(t => 
                    (t.name || t.file) === (tarif.name || tarif.file)
                )
            );
            
            // ‚ú® 3. ARAMA Fƒ∞LTRESƒ∞ (sadece se√ßili olmayanlar √ºzerinde)
            if (searchTerm) {
                unselectedCards = unselectedCards.filter(tarif => {
                    const tarifNameRaw = tarif.name || tarif.file || '';
                    const tarifName = tarifNameRaw.replace(/\.(jpg|jpeg|png)$/i, '');
                    return smartSearch(searchTerm, tarifName);
                });
            }
            
            // ‚ú® 4. SE√áƒ∞Lƒ∞ KARTLAR + Fƒ∞LTRELENMƒ∞≈û KARTLAR
            const displayList = [...selectedCards, ...unselectedCards];

            if (displayList.length === 0) {
                grid.innerHTML = '<div class="loading">Arama sonucu bulunamadƒ±</div>';
                return;
            }

            grid.innerHTML = displayList.map((tarif) => {
                const tarifNameRaw = tarif.name || tarif.file || '';
                const imageUrl = tarif.download_url || 
                                `https://raw.githubusercontent.com/mustafasacar35/lipodem-takip-paneli-2.2/main/tarifler/${tarifNameRaw}`;
                const tarifName = tarifNameRaw.replace(/\.(jpg|jpeg|png)$/i, '');
                
                // Yemek verisini bul (makrolar i√ßin) - daha esnek e≈üle≈ütirme
                const foodData = foodDatabase.find(food => {
                    const foodNameNormalized = normalizeText(food.name || '');
                    const tarifNameNormalized = normalizeText(tarifName);
                    
                    // Tam e≈üle≈üme
                    if (foodNameNormalized === tarifNameNormalized) return true;
                    
                    // Alt √ßizgi ve bo≈üluk farklƒ±lƒ±klarƒ±nƒ± g√∂z ardƒ± et
                    const foodNameClean = foodNameNormalized.replace(/_/g, '');
                    const tarifNameClean = tarifNameNormalized.replace(/_/g, '');
                    if (foodNameClean === tarifNameClean) return true;
                    
                    // Kelime bazƒ±nda e≈üle≈üme
                    if (foodNameNormalized.includes(tarifNameNormalized) || tarifNameNormalized.includes(foodNameNormalized)) return true;
                    
                    return false;
                });
                
                // Se√ßili mi kontrol et - SIKI KONTROL
                const isSelected = selectedTarifler.some(t => {
                    const tIdentifier = t.name || t.file || '';
                    const tarifIdentifier = tarif.name || tarif.file || '';
                    return tIdentifier === tarifIdentifier;
                });
                const selectedClass = isSelected ? 'selected' : '';
                
                // Makrolar her zaman g√∂ster - foodData yoksa da placeholder g√∂ster
                let macrosHTML = '';
                if (foodData && (foodData.calories || foodData.carbs || foodData.protein || foodData.fat)) {
                    macrosHTML = `
                        <div class="food-macros" style="font-size: 10px; color: #444; margin-top: 4px; padding: 4px; background: rgba(255,255,255,0.95); border-radius: 4px; border: 1px solid #e0e0e0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; text-align: center;">
                                <span title="Kalori" style="font-weight: 500;">üî•${Math.round(foodData.calories || 0)}</span>
                                <span title="Karbonhidrat" style="font-weight: 500;">üçû${Math.round(foodData.carbs || 0)}g</span>
                                <span title="Protein" style="font-weight: 500;">ü•©${Math.round(foodData.protein || 0)}g</span>
                                <span title="Yaƒü" style="font-weight: 500;">üßà${Math.round(foodData.fat || 0)}g</span>
                            </div>
                        </div>
                    `;
                } else {
                    // E≈üle≈üme yoksa veya makro bilgisi yoksa
                    macrosHTML = `
                        <div class="food-macros" style="font-size: 9px; color: #999; margin-top: 4px; padding: 3px; background: rgba(240,240,240,0.5); border-radius: 4px; text-align: center;">
                            Makro bilgisi bulunamadƒ±
                        </div>
                    `;
                }
                
                return `
                    <div class="tarif-item ${selectedClass}" data-tarif-name="${tarifNameRaw}" onclick="selectTarifByName('${tarifNameRaw}')">
                        <img src="${imageUrl}" alt="${tarifName}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eüì∑%3C/text%3E%3C/svg%3E'">
                        <div class="tarif-name">${tarifName}</div>
                        ${macrosHTML}
                    </div>
                `;
            }).join('');
            
            // Se√ßim sayƒ±sƒ±nƒ± g√ºncelle
            updateSelectionCount();
        }

        // Arama filtresi (Manuel e≈üle≈ütirme)
        function filterTarifKartlari() {
            displayTarifKartlari();
        }

        // Se√ßimi temizle (Manuel)
        function clearManuelSelection() {
            selectedTarifler = [];
            displayTarifKartlari();
        }

        // Tarif se√ß (√ßoklu se√ßim) - ƒ∞sme g√∂re
        function selectTarifByName(tarifName) {
            // tarifName = dosya adƒ± ile gelebilir (√∂rn: "keto_kofte.jpg")
            // tarifKartlari'da name veya file ile e≈üle≈ümeli
            const tarif = tarifKartlari.find(t => 
                (t.name === tarifName || t.file === tarifName) ||
                (t.name && t.name.replace(/\.(jpg|jpeg|png)$/i, '') === tarifName) ||
                (t.file && t.file.replace(/\.(jpg|jpeg|png)$/i, '') === tarifName)
            );
            
            if (!tarif) {
                console.error('Tarif bulunamadƒ±:', tarifName);
                console.log('Aranan:', tarifName);
                console.log('Mevcut kartlar:', tarifKartlari.map(t => ({ name: t.name, file: t.file })));
                return;
            }
            
            const tarifItem = document.querySelector(`.tarif-item[data-tarif-name="${tarifName}"]`);
            if (!tarifItem) {
                console.error('Tarif elementi bulunamadƒ±:', tarifName);
                return;
            }
            
            // Zaten se√ßili mi kontrol et (name VEYA file ile kar≈üƒ±la≈ütƒ±r)
            const existingIndex = selectedTarifler.findIndex(t => 
                (t.name || t.file) === (tarif.name || tarif.file)
            );
            
            console.log('üîç selectTarifByName √ßaƒürƒ±ldƒ±:', {
                tarifName: tarifName,
                bulunanTarif: {name: tarif.name, file: tarif.file},
                existingIndex: existingIndex,
                currentSelected: selectedTarifler.map(t => t.name || t.file)
            });
            
            if (existingIndex > -1) {
                // Zaten se√ßili, kaldƒ±r
                selectedTarifler.splice(existingIndex, 1);
                tarifItem.classList.remove('selected');
                console.log('‚ûñ Se√ßim kaldƒ±rƒ±ldƒ±');
            } else {
                // Se√ßili deƒüil, ekle
                selectedTarifler.push(tarif);
                tarifItem.classList.add('selected');
                console.log('‚ûï Se√ßim eklendi');
            }
            
            // Se√ßim sayƒ±sƒ±nƒ± g√∂ster
            updateSelectionCount();
        }
        
        // Eski fonksiyon - geriye d√∂n√ºk uyumluluk i√ßin
        function selectTarif(index) {
            const tarif = tarifKartlari[index];
            if (tarif) {
                selectTarifByName(tarif.name);
            }
        }
        
        // Se√ßim sayƒ±sƒ±nƒ± g√ºncelle
        function updateSelectionCount() {
            const countElement = document.getElementById('selectionCount');
            if (countElement) {
                countElement.textContent = selectedTarifler.length > 0 
                    ? `${selectedTarifler.length} tarif se√ßildi` 
                    : '';
            }
        }

        // Yasak kurallarƒ± sekmesi i√ßin tarif kartlarƒ±nƒ± g√∂ster
        function displayTarifKartlariYasak() {
            console.log('üîç displayTarifKartlariYasak √ßaƒürƒ±ldƒ±');
            console.log('üì¶ tarifKartlari.length:', tarifKartlari.length);
            console.log('üçΩÔ∏è currentFood:', currentFood);
            
            const grid = document.getElementById('tarifGridYasak');
            const searchTerm = document.getElementById('searchTarifYasak')?.value.toLowerCase() || '';
            
            if (!tarifKartlari || tarifKartlari.length === 0) {
                console.error('‚ùå tarifKartlari bo≈ü veya tanƒ±msƒ±z!');
                grid.innerHTML = '<div class="loading">Tarif kartlarƒ± y√ºkleniyor... L√ºtfen bekleyin.</div>';
                return;
            }

            // ‚úÖ D√úZELTME: getYasakKurallar() fonksiyonunu kullan (fuzzy matching ile)
            const existingYasaklar = getYasakKurallar(currentFood.name) || [];
            
            console.log('üö´ Bulunan yasaklar:', existingYasaklar);

            // Mevcut yasaklarƒ± se√ßili olarak i≈üaretle (sadece ilk a√ßƒ±lƒ±≈üta)
            if (selectedYasaklar.length === 0 && existingYasaklar.length > 0) {
                console.log('üîç Yasak kartlarƒ± e≈üle≈ütiriliyor:', existingYasaklar);
                
                existingYasaklar.forEach(name => {
                    if (!name) return; // Bo≈ü deƒüerleri atla
                    
                    console.log(`üîé "${name}" aranƒ±yor...`);
                    
                    const tarif = tarifKartlari.find(t => {
                        const tarifName = t.name || t.file || '';
                        const tarifFile = t.file || '';
                        
                        const match = normalizeText(tarifName) === normalizeText(name) ||
                               normalizeText(tarifFile) === normalizeText(name) ||
                               tarifName === name ||
                               tarifFile === name ||
                               tarifName.replace(/\.(jpg|jpeg|png)$/i, '') === name.replace(/\.(jpg|jpeg|png)$/i, '') ||
                               tarifFile.replace(/\.(jpg|jpeg|png)$/i, '') === name.replace(/\.(jpg|jpeg|png)$/i, '');
                        
                        if (match) {
                            console.log(`  ‚úÖ E≈üle≈üti: ${tarifFile}`);
                        }
                        
                        return match;
                    });
                    
                    if (tarif) {
                        if (!selectedYasaklar.find(t => (t.name || t.file) === (tarif.name || tarif.file))) {
                            selectedYasaklar.push(tarif);
                            console.log('‚úÖ Yasak se√ßildi:', tarif.name || tarif.file);
                        } else {
                            console.log('‚ö†Ô∏è Zaten se√ßili:', tarif.name || tarif.file);
                        }
                    } else {
                        console.warn(`‚ùå "${name}" tarifKartlari i√ßinde bulunamadƒ±!`);
                    }
                });
                
                console.log('üì¶ selectedYasaklar:', selectedYasaklar);
            }

            // Mevcut yasak bilgisini g√∂ster
            if (existingYasaklar.length > 0) {
                document.getElementById('currentYasak').style.display = 'block';
                document.getElementById('currentYasakName').textContent = existingYasaklar
                    .filter(n => n) // Bo≈ü deƒüerleri filtrele
                    .map(n => n.replace(/\.(jpg|jpeg|png)$/i, '').replace(/_/g, ' '))
                    .join(', ');
            } else {
                document.getElementById('currentYasak').style.display = 'none';
            }

            // ‚ú® 1. SE√áƒ∞Lƒ∞ KARTLARI AYIR (her zaman g√∂sterilecek)
            const selectedYasakCards = selectedYasaklar.slice();
            
            // ‚ú® 2. SE√áƒ∞Lƒ∞ OLMAYAN KARTLARI Fƒ∞LTRELE
            let unselectedYasakCards = tarifKartlari.filter(tarif => 
                !selectedYasaklar.some(t => 
                    (t.name || t.file) === (tarif.name || tarif.file)
                )
            );
            
            // ‚ú® 3. ARAMA Fƒ∞LTRESƒ∞ (sadece se√ßili olmayanlar √ºzerinde)
            if (searchTerm) {
                unselectedYasakCards = unselectedYasakCards.filter(tarif => {
                    const tarifNameRaw = tarif.name || tarif.file || '';
                    const tarifName = tarifNameRaw.replace(/\.(jpg|jpeg|png)$/i, '');
                    return smartSearch(searchTerm, tarifName);
                });
            }
            
            // ‚ú® 4. SE√áƒ∞Lƒ∞ KARTLAR + Fƒ∞LTRELENMƒ∞≈û KARTLAR
            const displayList = [...selectedYasakCards, ...unselectedYasakCards];

            if (displayList.length === 0) {
                grid.innerHTML = '<div class="loading">Arama sonucu bulunamadƒ±</div>';
                return;
            }

            grid.innerHTML = displayList.map((tarif) => {
                const tarifNameRaw = tarif.name || tarif.file || '';
                const imageUrl = tarif.download_url || 
                                `https://raw.githubusercontent.com/mustafasacar35/lipodem-takip-paneli-2.2/main/tarifler/${tarifNameRaw}`;
                const tarifName = tarifNameRaw.replace(/\.(jpg|jpeg|png)$/i, '');
                
                // Yemek verisini bul (makrolar i√ßin) - daha esnek e≈üle≈ütirme
                const foodData = foodDatabase.find(food => {
                    const foodNameNormalized = normalizeText(food.name || '');
                    const tarifNameNormalized = normalizeText(tarifName);
                    
                    // Tam e≈üle≈üme
                    if (foodNameNormalized === tarifNameNormalized) return true;
                    
                    // Alt √ßizgi ve bo≈üluk farklƒ±lƒ±klarƒ±nƒ± g√∂z ardƒ± et
                    const foodNameClean = foodNameNormalized.replace(/_/g, '');
                    const tarifNameClean = tarifNameNormalized.replace(/_/g, '');
                    if (foodNameClean === tarifNameClean) return true;
                    
                    // Kelime bazƒ±nda e≈üle≈üme
                    if (foodNameNormalized.includes(tarifNameNormalized) || tarifNameNormalized.includes(foodNameNormalized)) return true;
                    
                    return false;
                });
                
                // Se√ßili mi kontrol et - SIKI KONTROL
                const isSelected = selectedYasaklar.some(t => {
                    const tIdentifier = t.name || t.file || '';
                    const tarifIdentifier = tarif.name || tarif.file || '';
                    return tIdentifier === tarifIdentifier;
                });
                const selectedClass = isSelected ? 'selected' : '';
                
                // Makrolar her zaman g√∂ster
                let macrosHTML = '';
                if (foodData && (foodData.calories || foodData.carbs || foodData.protein || foodData.fat)) {
                    macrosHTML = `
                        <div class="food-macros" style="font-size: 10px; color: #444; margin-top: 4px; padding: 4px; background: rgba(255,255,255,0.95); border-radius: 4px; border: 1px solid #e0e0e0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; text-align: center;">
                                <span title="Kalori" style="font-weight: 500;">üî•${Math.round(foodData.calories || 0)}</span>
                                <span title="Karbonhidrat" style="font-weight: 500;">üçû${Math.round(foodData.carbs || 0)}g</span>
                                <span title="Protein" style="font-weight: 500;">ü•©${Math.round(foodData.protein || 0)}g</span>
                                <span title="Yaƒü" style="font-weight: 500;">üßà${Math.round(foodData.fat || 0)}g</span>
                            </div>
                        </div>
                    `;
                } else {
                    macrosHTML = `
                        <div class="food-macros" style="font-size: 9px; color: #999; margin-top: 4px; padding: 3px; background: rgba(240,240,240,0.5); border-radius: 4px; text-align: center;">
                            Makro bilgisi bulunamadƒ±
                        </div>
                    `;
                }
                
                return `
                    <div class="tarif-item ${selectedClass}" data-tarif-name="${tarifNameRaw}" onclick="selectYasakByName('${tarifNameRaw}')" style="${isSelected ? 'border-color: #dc3545;' : ''}">
                        <img src="${imageUrl}" alt="${tarifName}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eüì∑%3C/text%3E%3C/svg%3E'">
                        <div class="tarif-name">${tarifName}</div>
                        ${macrosHTML}
                    </div>
                `;
            }).join('');
            
            updateYasakCount();
        }

        // Arama filtresi (Yasak kurallarƒ±)
        function filterTarifKartlariYasak() {
            displayTarifKartlariYasak();
        }

        // Se√ßimi temizle (Yasak)
        function clearYasakSelection() {
            selectedYasaklar = [];
            displayTarifKartlariYasak();
        }

        // Yasak se√ß (√ßoklu se√ßim) - ƒ∞sme g√∂re
        function selectYasakByName(tarifName) {
            // tarifName = dosya adƒ± ile gelebilir (√∂rn: "keto_kofte.jpg")
            const tarif = tarifKartlari.find(t => 
                (t.name === tarifName || t.file === tarifName) ||
                (t.name && t.name.replace(/\.(jpg|jpeg|png)$/i, '') === tarifName) ||
                (t.file && t.file.replace(/\.(jpg|jpeg|png)$/i, '') === tarifName)
            );
            
            if (!tarif) {
                console.error('Yasak i√ßin tarif bulunamadƒ±:', tarifName);
                console.log('Aranan:', tarifName);
                console.log('Mevcut kartlar:', tarifKartlari.map(t => ({ name: t.name, file: t.file })));
                return;
            }
            
            const tarifItem = document.querySelector(`#tarifGridYasak .tarif-item[data-tarif-name="${tarifName}"]`);
            if (!tarifItem) {
                console.error('Yasak i√ßin tarif elementi bulunamadƒ±:', tarifName);
                return;
            }
            
            // Zaten se√ßili mi kontrol et (name VEYA file ile kar≈üƒ±la≈ütƒ±r)
            const existingIndex = selectedYasaklar.findIndex(t => 
                t.name === tarif.name || t.file === tarif.file ||
                t.name === tarifName || t.file === tarifName
            );
            
            if (existingIndex > -1) {
                // Zaten se√ßili, kaldƒ±r
                selectedYasaklar.splice(existingIndex, 1);
                tarifItem.classList.remove('selected');
                tarifItem.style.borderColor = '';
            } else {
                // Se√ßili deƒüil, ekle
                selectedYasaklar.push(tarif);
                tarifItem.classList.add('selected');
                tarifItem.style.borderColor = '#dc3545';
            }
            
            updateYasakCount();
        }
        
        // Eski fonksiyon - geriye d√∂n√ºk uyumluluk i√ßin
        function selectYasak(index) {
            const tarif = tarifKartlari[index];
            if (tarif) {
                selectYasakByName(tarif.name);
            }
        }

        // Yasak sayƒ±sƒ±nƒ± g√ºncelle
        function updateYasakCount() {
            const countElement = document.getElementById('yasakCount');
            if (countElement) {
                countElement.textContent = selectedYasaklar.length > 0 
                    ? `${selectedYasaklar.length} kart yasaklanacak` 
                    : '';
            }
        }

        // Modal kapat
        function closeModal() {
            document.getElementById('matchModal').classList.remove('active');
            currentFood = null;
            selectedTarifler = [];
            selectedYasaklar = [];
            currentTab = 'manuel';
            switchTab('manuel');
        }

        // GitHub'dan g√ºncel veri √ßek
        async function refreshData(evt) {
            const btn = evt?.target || document.getElementById('btnRefreshData');
            const originalText = btn ? btn.textContent : '';
            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ Y√ºkleniyor...';
            }
            
            try {
                await loadManuelEslestirmeler();
                await loadEslesmemeKurallari();
                displayFoods();
                
                if (btn) {
                    btn.textContent = '‚úÖ G√ºncellendi!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('Veri yenileme hatasƒ±:', error);
                btn.textContent = '‚ùå Hata olu≈ütu';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        }

        // GitHub'a dosya y√ºkle/g√ºncelle
        async function updateGithubFile(filePath, content, commitMessage) {
            const token = getGithubToken();
            if (!token) {
                openTokenModal();
                throw new Error('GitHub token gerekli');
            }

            try {
                // 1. Dosyanƒ±n mevcut SHA'sƒ±nƒ± al (üî• CACHE-BUSTING ile g√ºncel versiyonu al)
                const getUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${filePath}?ref=${GITHUB_BRANCH}&t=${Date.now()}`;
                const getResponse = await fetch(getUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    cache: 'no-cache' // üî• Cache'i devre dƒ±≈üƒ± bƒ±rak
                });

                let sha = null;
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    sha = data.sha;
                    console.log(`üîç G√ºncel SHA alƒ±ndƒ±: ${filePath} ‚Üí ${sha.substring(0, 8)}...`);
                } else if (getResponse.status === 401) {
                    throw new Error('‚ùå GitHub Token Hatasƒ±!\n\nToken ge√ßersiz veya yetkisiz.\n\nL√ºtfen yeni token olu≈üturun:\n1. github.com ‚Üí Settings ‚Üí Developer settings\n2. Personal access tokens ‚Üí Tokens (classic)\n3. Generate new token (classic)\n4. "repo" iznini se√ßin (tam eri≈üim)\n5. Token\'ƒ± kopyalayƒ±p bu sayfadaki üîë butonundan girin');
                } else if (getResponse.status !== 404) {
                    // 404 = dosya yok (yeni olu≈üturulacak), diƒüer hatalar sorun
                    const error = await getResponse.json();
                    console.warn('‚ö†Ô∏è SHA alma hatasƒ±:', error);
                }

                // 2. Dosyayƒ± g√ºncelle veya olu≈ütur
                const putUrl = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${filePath}`;
                
                // üî• B√úY√úK DOSYALAR ƒ∞√áƒ∞N G√úVENLƒ∞ BASE64 ENCODING
                // Stack overflow √∂nlemek i√ßin: chunk'larla base64 encode
                const encoder = new TextEncoder();
                const uint8Array = encoder.encode(content);
                
                // Binary string'i k√º√ß√ºk par√ßalarla olu≈ütur (stack overflow √∂nleme)
                let binaryString = '';
                const chunkSize = 8192; // 8KB chunks (g√ºvenli boyut)
                
                for (let i = 0; i < uint8Array.length; i += chunkSize) {
                    const chunk = uint8Array.slice(i, i + chunkSize);
                    // Spread operator yerine apply kullan (daha g√ºvenli)
                    binaryString += String.fromCharCode.apply(null, chunk);
                }
                
                // ≈ûimdi t√ºm binary string'i base64'e √ßevir
                const base64Content = btoa(binaryString);
                
                console.log(`üì¶ Base64 encoding tamamlandƒ±: ${(base64Content.length / 1024).toFixed(1)} KB`);
                
                const putResponse = await fetch(putUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: commitMessage,
                        content: base64Content,
                        sha: sha, // null ise yeni dosya olu≈ütur
                        branch: GITHUB_BRANCH
                    })
                });

                if (!putResponse.ok) {
                    const error = await putResponse.json();
                    if (putResponse.status === 401) {
                        throw new Error('‚ùå GitHub Token Hatasƒ±!\n\nToken ge√ßersiz veya yetkisiz.\n\nL√ºtfen yeni token olu≈üturun:\n1. github.com ‚Üí Settings ‚Üí Developer settings\n2. Personal access tokens ‚Üí Tokens (classic)\n3. Generate new token (classic)\n4. "repo" iznini se√ßin (tam eri≈üim)\n5. Token\'ƒ± kopyalayƒ±p bu sayfadaki üîë butonundan girin');
                    }
                    throw new Error(error.message || 'GitHub API hatasƒ±');
                }

                const result = await putResponse.json();
                console.log(`‚úÖ GitHub'a kaydedildi: ${filePath}`);
                return result;
            } catch (error) {
                console.error('GitHub API Hatasƒ±:', error);
                throw error;
            }
        }

        // Manuel e≈üle≈ütirmeyi Sƒ∞L ve GitHub'a kaydet
        async function deleteManuelMatch(evt) {
            if (!currentFood) return;

            const cleanedName = cleanYemekAdi(currentFood.name);
            const normalizedKey = normalizeText(cleanedName);
            const lowercaseSpaced = cleanedName.toLowerCase()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                .replace(/√ß/g, 'c').replace(/√á/g, 'C')
                .trim();

            const candidateKeys = [
                currentFood.name,
                cleanedName,
                lowercaseSpaced,
                normalizedKey,
                normalizeText(currentFood.name)
            ].filter(Boolean);

            let actualKey = candidateKeys.find(key => manuelEslestirmeler[key]);

            if (!actualKey) {
                const normalized = normalizeText(currentFood.name);
                actualKey = Object.keys(manuelEslestirmeler).find(key => normalizeText(key) === normalized) || null;
            }

            if (!actualKey || !manuelEslestirmeler[actualKey]) {
                alert('Bu yemek i√ßin mevcut bir manuel e≈üle≈ütirme yok!');
                return;
            }

            if (!confirm(`"${currentFood.name}" i√ßin manuel e≈üle≈ütirmeyi silmek istediƒüinize emin misiniz?`)) {
                return;
            }

            const btn = evt?.target || document.getElementById('btnDeleteManuel');
            const originalText = btn ? btn.textContent : '';
            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ Siliniyor...';
            }

            try {
                // ‚úÖ SUPABASE'DEN SADECE BU YEMEƒûƒ∞N E≈ûLE≈ûTƒ∞RMELERƒ∞Nƒ∞ Sƒ∞L
                console.log('üóëÔ∏è Supabase\'den manuel e≈üle≈ütirme siliniyor:', currentFood.name);
                
                // Supabase'den bu yemek i√ßin t√ºm e≈üle≈ütirmeleri sil
                const { error } = await window.DAL.supabaseClient
                    .from('food_matchings')
                    .delete()
                    .eq('food_name', currentFood.name)
                    .eq('type', 'manuel');
                
                if (error) throw error;
                
                // Local cache'den de sil
                delete manuelEslestirmeler[actualKey];
                
                console.log(`‚úÖ Manuel e≈üle≈ütirme silindi: "${currentFood.name}"`);
                
                // ‚úÖ Bildirim g√∂ster
                showNotification(
                    `<strong>Manuel E≈üle≈ütirme Silindi!</strong><br>
                    üóëÔ∏è Yemek: ${currentFood.name}`,
                    'info'
                );
                
                if (btn) {
                    btn.textContent = '‚úÖ Silindi!';
                    setTimeout(async () => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                        
                        // Supabase'den g√ºncel veriyi y√ºkle
                        await loadManuelEslestirmeler();
                        
                        closeModal();
                        displayFoods();
                    }, 1500);
                } else {
                    // Supabase'den g√ºncel veriyi y√ºkle
                    await loadManuelEslestirmeler();
                    closeModal();
                    displayFoods();
                }

            } catch (error) {
                console.error('Silme hatasƒ±:', error);
                
                // ‚ùå Hata bildirimi
                showNotification(
                    `<strong>Silme Hatasƒ±!</strong><br>${error.message}`,
                    'error'
                );
                
                if (btn) {
                    btn.textContent = '‚ùå Hata!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 2000);
                }
            }
        }

        // Manuel e≈üle≈ütirmeyi GitHub'a kaydet
        async function saveManuelMatch(evt) {
            if (!currentFood || selectedTarifler.length === 0) {
                alert('L√ºtfen en az bir tarif kartƒ± se√ßin!');
                return;
            }
            
            console.log('üíæ KAYIT BA≈ûLIYOR - selectedTarifler:', selectedTarifler.map(t => ({
                name: t.name,
                file: t.file,
                identifier: t.name || t.file
            })));

            const btn = evt?.target || document.getElementById('btnSaveManuel');
            const originalText = btn ? btn.textContent : '';
            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ Kaydediliyor...';
            }

            try {
                const normalizedKey = normalizeText(currentFood.name);
                
                // üî• SADECE DOSYA ADI (file) KAYDET - patient_nutrition ile aynƒ± format
                const kartDosyalari = selectedTarifler.map(t => {
                    const fileName = t.file || t.name || '';
                    // Eƒüer .jpg yoksa ekle (tutarlƒ±lƒ±k i√ßin)
                    return fileName.endsWith('.jpg') || fileName.endsWith('.jpeg') || fileName.endsWith('.png')
                        ? fileName
                        : fileName + '.jpg';
                });
                
                console.log('üîç KAYIT DETAYI:');
                console.log('  - selectedTarifler:', selectedTarifler.map(t => t.name || t.file));
                console.log('  - kartDosyalari (dosya adlarƒ±):', kartDosyalari);
                console.log('  - Unique kartDosyalari:', [...new Set(kartDosyalari)]);
                
                // Yeni e≈üle≈ütirme objesi
                const matchData = {
                    orijinalMetin: currentFood.name,
                    kartlar: kartDosyalari, // ‚úÖ Dosya adlarƒ± (.jpg dahil)
                    eklemeTarihi: new Date().toISOString()
                };

                // Mevcut verileri g√ºncelle
                manuelEslestirmeler[normalizedKey] = matchData;
                
                const tarifNames = kartDosyalari.join(', ');
                
                // ‚úÖ SADECE BU YEMEƒûƒ∞N E≈ûLE≈ûTƒ∞RMESƒ∞Nƒ∞ SUPABASE'E KAYDET
                console.log('üíæ Supabase\'e manuel e≈üle≈ütirme kaydediliyor...');
                
                // Sadece bu yemek i√ßin e≈üle≈ütirmeyi g√∂nder
                const singleFoodMatching = {
                    version: "1.0",
                    sonGuncelleme: new Date().toISOString(),
                    eslestirmeler: {
                        [normalizedKey]: matchData
                    }
                };
                
                await window.DAL.updateFoodMatchings(singleFoodMatching);
                console.log('‚úÖ Manuel e≈üle≈ütirme kaydedildi:', currentFood.name, '‚Üí', tarifNames);
                
                // ‚úÖ Bildirim g√∂ster
                showNotification(
                    `<strong>Manuel E≈üle≈ütirme Kaydedildi!</strong><br>
                    üçΩÔ∏è Yemek: ${currentFood.name}<br>
                    üìã Tarifler: ${tarifNames}<br>
                    üìä Toplam: ${selectedTarifler.length} tarif`,
                    'success'
                );
                
                if (btn) {
                    btn.textContent = '‚úÖ Kaydedildi!';
                    setTimeout(async () => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                        
                        // Manuel e≈üle≈ütirmeleri Supabase'den yeniden y√ºkle
                        await loadManuelEslestirmeler();
                        
                        closeModal();
                        displayFoods(); // Ekranƒ± g√ºncelle
                    }, 1500);
                } else {
                    await loadManuelEslestirmeler();
                    closeModal();
                    displayFoods();
                }

            } catch (error) {
                console.error('Kayƒ±t hatasƒ±:', error);
                
                // ‚ùå Hata bildirimi
                showNotification(
                    `<strong>Kayƒ±t Hatasƒ±!</strong><br>${error.message}`,
                    'error'
                );
                if (btn) {
                    btn.textContent = '‚ùå Hata!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 2000);
                }
                alert(`‚ùå Kayƒ±t hatasƒ±:\n${error.message}\n\nToken ge√ßerli mi kontrol edin.`);
            }
        }

        // Yasak kuralƒ±nƒ± Sƒ∞L ve GitHub'a kaydet
        async function deleteYasakMatch(evt) {
            if (!currentFood) return;

            // ‚úÖ D√úZELTME: Yasak kuralƒ±nƒ± bulmak i√ßin fuzzy matching kullan
            const existingYasaklar = getYasakKurallar(currentFood.name);
            
            if (!existingYasaklar || existingYasaklar.length === 0) {
                alert('Bu yemek i√ßin mevcut bir yasak kuralƒ± yok!');
                return;
            }

            if (!confirm(`"${currentFood.name}" i√ßin yasak kuralƒ±nƒ± silmek istediƒüinize emin misiniz?`)) {
                return;
            }

            const btn = evt?.target || document.getElementById('btnDeleteYasak');
            const originalText = btn ? btn.textContent : '';
            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ Siliniyor...';
            }

            try {
                // ‚úÖ D√úZELTME: Ger√ßek key'i bul ve sil
                const cleanedYemekAdi = cleanYemekAdi(currentFood.name);
                const normalized = normalizeText(cleanedYemekAdi);
                const lowercaseSpaced = cleanedYemekAdi.toLowerCase() // ‚úÖ FIX: cleanedYemekAdi kullan
                    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                    .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                    .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                    .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                    .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                    .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                    .replace(/√ß/g, 'c').replace(/√á/g, 'C')
                    .trim();
                
                // Ger√ßek key'i bul ve t√ºm varyantlarƒ± listede tut
                let actualKey = null;
                const keysToRemove = new Set();
                const keysToTry = [currentFood.name, cleanedYemekAdi, lowercaseSpaced, normalized, normalizeText(currentFood.name)];

                for (const key of keysToTry) {
                    if (key && eslesmemeKurallari[key]) {
                        if (!actualKey) actualKey = key;
                        keysToRemove.add(key);
                    }
                }

                // Fuzzy match ile key bul (ve aynƒ± normalized deƒüere sahip diƒüerleri)
                const allKeys = Object.keys(eslesmemeKurallari);
                for (const key of allKeys) {
                    const keyNormalized = normalizeText(key);
                    if (keyNormalized === normalized || key.toLowerCase() === lowercaseSpaced.toLowerCase()) {
                        if (!actualKey) {
                            actualKey = key;
                            console.log(`‚úÖ Fuzzy match i√ßin silme: "${currentFood.name}" ‚Üí "${key}"`);
                        }
                        keysToRemove.add(key);
                    }
                }

                if (!actualKey) {
                    throw new Error('Yasak kuralƒ± anahtarƒ± bulunamadƒ±!');
                }

                console.log(`üóëÔ∏è Silinecek anahtarlar: ${Array.from(keysToRemove).join(', ') || actualKey}`);
                
                // ‚úÖ √ñNCE: Local kopyasƒ±ndan sil (JSON olu≈üturmak i√ßin)
                const updatedEslesmemeKurallari = { ...eslesmemeKurallari };
                keysToRemove.forEach(key => delete updatedEslesmemeKurallari[key]);

                // Supabase i√ßin blacklist data hazƒ±rla
                const blacklistData = {
                    version: "1.0",
                    sonGuncelleme: new Date().toISOString(),
                    kurallar: {
                        version: "1.0",
                        sonGuncelleme: new Date().toISOString(),
                        eslesmemeKurallari: updatedEslesmemeKurallari
                    }
                };

                // ‚úÖ SADECE SUPABASE'E KAYDET (GitHub kaldƒ±rƒ±ldƒ±)
                console.log('üíæ Supabase\'e yasak kuralƒ± siliniyor...');
                await window.DAL.updateFoodBlacklist(blacklistData);
                
                // ‚úÖ SONRA: Ba≈üarƒ±lƒ± olduysa local objeden de sil
                keysToRemove.forEach(key => delete eslesmemeKurallari[key]);

                console.log('‚úÖ Yasak kuralƒ± silindi:', currentFood.name);
                
                // ‚úÖ Bildirim g√∂ster
                showNotification(
                    `<strong>Yasak Kuralƒ± Silindi!</strong><br>
                    üóëÔ∏è Yemek: ${currentFood.name}`,
                    'info'
                );
                
                if (btn) {
                    btn.textContent = '‚úÖ Silindi!';
                    setTimeout(async () => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                        
                        console.log('üîÑ Yenileme ba≈ülƒ±yor...');
                        
                        // ‚úÖ Se√ßili yasaklarƒ± temizle
                        selectedYasaklar = [];
                        console.log('‚úÖ selectedYasaklar temizlendi');
                        
                        // ‚úÖ Yasak kurallarƒ±nƒ± GitHub'dan yeniden y√ºkle
                        console.log("‚è≥ GitHub'dan y√ºkleniyor...");
                        await loadEslesmemeKurallari();
                        // ‚úÖ CDN gecikmesi olsa bile silinen anahtarlarƒ± tekrar kaldƒ±r
                        keysToRemove.forEach(key => {
                            if (eslesmemeKurallari[key]) {
                                console.log(`‚ôªÔ∏è Yeniden temizlendi: ${key}`);
                                delete eslesmemeKurallari[key];
                            }
                        });
                        console.log("‚úÖ GitHub'dan y√ºklendi, eslesmemeKurallari:", Object.keys(eslesmemeKurallari).length, 'adet');
                        
                        // ‚úÖ Ana sayfadaki badge'leri g√ºncelle
                        console.log('üîÑ Ana sayfa yenileniyor...');
                        displayFoods();
                        
                        // ‚úÖ Modal'ƒ± kapat
                        console.log('‚úÖ Modal kapatƒ±lƒ±yor...');
                        closeModal();
                        
                        console.log('‚úÖ T√ºm i≈ülemler tamamlandƒ±!');
                    }, 1500);
                } else {
                    selectedYasaklar = [];
                    await loadEslesmemeKurallari();
                    keysToRemove.forEach(key => delete eslesmemeKurallari[key]);
                    displayFoods();
                    closeModal();
                }

            } catch (error) {
                console.error('Silme hatasƒ±:', error);
                
                // ‚ùå Hata bildirimi
                showNotification(
                    `<strong>Silme Hatasƒ±!</strong><br>${error.message}`,
                    'error'
                );
                if (btn) {
                    btn.textContent = '‚ùå Hata!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 2000);
                }
            }
        }

        // Yasak kuralƒ±nƒ± GitHub'a kaydet
        async function saveYasakMatch(evt) {
            if (!currentFood || selectedYasaklar.length === 0) {
                alert('L√ºtfen en az bir tarif kartƒ± se√ßin!');
                return;
            }

            const btn = evt?.target || document.getElementById('btnSaveYasak');
            const originalText = btn ? btn.textContent : '';
            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ Kaydediliyor...';
            }

            try {
                // ‚úÖ D√úZELTME: Parantez ve quantity'yi temizleyerek key olu≈ütur
                const cleanedName = cleanYemekAdi(currentFood.name);
                const lowercaseSpaced = cleanedName.toLowerCase()
                    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                    .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                    .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                    .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                    .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                    .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                    .replace(/√ß/g, 'c').replace(/√á/g, 'C')
                    .trim();
                
                console.log(`üíæ Kaydedilecek key: "${lowercaseSpaced}" (orijinal: "${currentFood.name}")`);
                
                // üî• SADECE DOSYA ADI (file) KAYDET - patient_nutrition ile aynƒ± format
                const yasakDosyalari = selectedYasaklar.map(t => {
                    const fileName = t.file || t.name || '';
                    // Eƒüer .jpg yoksa ekle (tutarlƒ±lƒ±k i√ßin)
                    return fileName.endsWith('.jpg') || fileName.endsWith('.jpeg') || fileName.endsWith('.png')
                        ? fileName
                        : fileName + '.jpg';
                });
                
                // Yeni yasak kuralƒ± objesi
                const yasakData = {
                    orijinalMetin: currentFood.name,
                    yasakliKartlar: yasakDosyalari, // ‚úÖ Dosya adlarƒ± (.jpg dahil)
                    eklemeTarihi: new Date().toISOString()
                };

                // Mevcut verileri g√ºncelle
                eslesmemeKurallari[lowercaseSpaced] = yasakData;

                // üî• SADECE T√úM KURALLARI G√ñNDER (DAL i√ßinde tek kayƒ±t olarak saklanƒ±yor)
                const blacklistData = eslesmemeKurallari;

                // ‚úÖ SADECE SUPABASE'E KAYDET
                const yasakNames = yasakDosyalari.join(', ');
                console.log('üíæ Supabase\'e yasak kuralƒ± kaydediliyor...');
                await window.DAL.updateFoodBlacklist(blacklistData);
                console.log('‚úÖ Yasak kaydedildi:', currentFood.name, '‚õî', yasakNames);
                
                // ‚úÖ Bildirim g√∂ster
                showNotification(
                    `<strong>E≈üle≈üme Yasaƒüƒ± Kaydedildi!</strong><br>
                    üçΩÔ∏è Yemek: ${currentFood.name}<br>
                    üö´ Yasaklanan: ${yasakNames}<br>
                    üìä Toplam: ${selectedYasaklar.length} kart`,
                    'warning'
                );
                
                if (btn) {
                    btn.textContent = '‚úÖ Kaydedildi!';
                    setTimeout(async () => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                        
                        // ‚úÖ Se√ßili yasaklarƒ± temizle
                        selectedYasaklar = [];
                        
                        // ‚úÖ Yasak kurallarƒ±nƒ± GitHub'dan yeniden y√ºkle (cache bypass ile)
                        await loadEslesmemeKurallari();
                        
                        // ‚úÖ Ana sayfadaki badge'leri g√ºncelle
                        displayFoods();
                        
                        // ‚úÖ Modal'ƒ± kapat
                        closeModal();
                    }, 1500);
                } else {
                    selectedYasaklar = [];
                    await loadEslesmemeKurallari();
                    displayFoods();
                    closeModal();
                }

            } catch (error) {
                console.error('Kayƒ±t hatasƒ±:', error);
                
                // ‚ùå Hata bildirimi
                showNotification(
                    `<strong>Kayƒ±t Hatasƒ±!</strong><br>${error.message}`,
                    'error'
                );
                
                if (btn) {
                    btn.textContent = '‚ùå Hata!';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }, 2000);
                }
                alert(`‚ùå Kayƒ±t hatasƒ±:\n${error.message}\n\nToken ge√ßerli mi kontrol edin.`);
            }
        }

        // ESKƒ∞ saveMatch fonksiyonunu kaldƒ±rdƒ±k, artƒ±k saveManuelMatch ve saveYasakMatch var

        // Filtre butonlarƒ±
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                displayFoods();
            });
        });

        // Arama
        document.getElementById('searchInput').addEventListener('input', displayFoods);

        // ESC ile modal kapat
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                // closeTokenModal() kaldƒ±rƒ±ldƒ± - GitHub modalƒ± yok
            }
        });

        // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapat
        document.getElementById('matchModal').addEventListener('click', (e) => {
            if (e.target.id === 'matchModal') {
                closeModal();
            }
        });

        // GitHub Token Modal kaldƒ±rƒ±ldƒ± - Artƒ±k Supabase kullanƒ±lƒ±yor


        // üîÑ SIRALAMA FONKSƒ∞YONLARI
        document.querySelectorAll('[data-sort]').forEach(btn => {
            btn.addEventListener('click', function() {
                const sortField = this.dataset.sort;
                sortFoods(sortField);
            });
        });

        function sortFoods(field) {
            if (displayedFoods.length === 0) return;

            // Aynƒ± alana tƒ±klandƒ±ysa y√∂n√º deƒüi≈ütir
            if (currentSort && currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort = { field: field, direction: 'asc' };
            }

            // Sƒ±ralama butonlarƒ±nƒ± g√ºncelle
            document.querySelectorAll('[data-sort]').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.sort === field) {
                    btn.classList.add('active');
                    // Ok i≈üareti ekle
                    const baseText = btn.textContent.split(' ')[0] + ' ' + btn.textContent.split(' ').slice(1).join(' ').replace('‚ñ≤', '').replace('‚ñº', '');
                    btn.textContent = baseText + (currentSort.direction === 'asc' ? ' ‚ñ≤' : ' ‚ñº');
                } else {
                    // Diƒüer butonlardan oklarƒ± kaldƒ±r
                    btn.textContent = btn.textContent.replace(' ‚ñ≤', '').replace(' ‚ñº', '');
                }
            });

            // Sƒ±rala
            displayedFoods.sort((a, b) => {
                let aVal, bVal;

                if (field === 'name') {
                    aVal = a.name.toLowerCase();
                    bVal = b.name.toLowerCase();
                } else {
                    aVal = a[field] || 0;
                    bVal = b[field] || 0;
                }

                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            // Yeniden g√∂ster
            displayFoods();
        }

        function resetSort() {
            currentSort = null;

            // Buton durumlarƒ±nƒ± sƒ±fƒ±rla
            document.querySelectorAll('[data-sort]').forEach(btn => {
                btn.classList.remove('active');
                btn.textContent = btn.textContent.replace(' ‚ñ≤', '').replace(' ‚ñº', '');
            });

            // Orijinal sƒ±ralamaya d√∂n
            displayFoods();
        }

        // ‚úèÔ∏è D√úZENLEME FONKSƒ∞YONLARI
        function openEditModalFromCard(cardElement) {
            try {
                const foodData = cardElement.getAttribute('data-food');
                const food = JSON.parse(decodeURIComponent(atob(foodData)));
                openEditModal(food);
            } catch (error) {
                console.error('Food data parse hatasƒ±:', error);
                alert('Bir hata olu≈ütu. L√ºtfen sayfayƒ± yenileyin.');
            }
        }

        // üßÆ Kalori Otomatik Hesaplama Fonksiyonu
        function calculateCalories() {
            const protein = parseFloat(document.getElementById('edit_protein').value) || 0;
            const carbs = parseFloat(document.getElementById('edit_carbs').value) || 0;
            const fat = parseFloat(document.getElementById('edit_fat').value) || 0;
            
            // Kalori form√ºl√º: (Karbonhidrat √ó 4) + (Protein √ó 4) + (Yaƒü √ó 9)
            const calories = (carbs * 4) + (protein * 4) + (fat * 9);
            
            document.getElementById('edit_calories').value = calories.toFixed(1);
        }

        function openEditModal(food) {
            editingFood = food;

            // Kategori dropdown'ƒ±nƒ± doldur
            populateCategoryDropdown();

            // Form alanlarƒ±nƒ± doldur
            document.getElementById('edit_name').value = food.name || '';
            document.getElementById('edit_protein').value = food.protein || 0;
            document.getElementById('edit_carbs').value = food.carbs || 0;
            document.getElementById('edit_fat').value = food.fat || 0;
            
            // Kaloriyi otomatik hesapla
            calculateCalories();
            
            document.getElementById('edit_category').value = food.category || '';
            document.getElementById('edit_role').value = food.role || '';
            
            // MealType checkbox'larƒ± ayarla
            document.getElementById('edit_mealType_breakfast').checked = false;
            document.getElementById('edit_mealType_lunch').checked = false;
            document.getElementById('edit_mealType_dinner').checked = false;
            
            if (food.mealType) {
                const mealTypes = Array.isArray(food.mealType) ? food.mealType : [food.mealType];
                mealTypes.forEach(type => {
                    const checkbox = document.getElementById(`edit_mealType_${type}`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // DietTypes checkbox'larƒ± ayarla
            document.getElementById('edit_dietType_ketojenik').checked = false;
            document.getElementById('edit_dietType_akdeniz').checked = false;
            document.getElementById('edit_dietType_vegan').checked = false;
            document.getElementById('edit_dietType_glutensiz').checked = false;
            
            if (food.dietTypes && Array.isArray(food.dietTypes)) {
                food.dietTypes.forEach(type => {
                    const checkbox = document.getElementById(`edit_dietType_${type}`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Miktar ve porsiyon alanlarƒ±
            document.getElementById('edit_minQuantity').value = food.minQuantity || '';
            document.getElementById('edit_maxQuantity').value = food.maxQuantity || '';
            document.getElementById('edit_step').value = food.step || '';
            document.getElementById('edit_yemek_portionMultiplier').value = food.multiplier || food.portionMultiplier || 1;
            
            // Sezon alanlarƒ± - seasonRange parse et
            let seasonMin = '';
            let seasonMax = '';
            if (food.seasonRange) {
                try {
                    const seasonArray = JSON.parse(food.seasonRange);
                    seasonMin = seasonArray[0] || '';
                    seasonMax = seasonArray[1] || '';
                } catch (e) {
                    console.warn('seasonRange parse hatasƒ±:', e);
                }
            }
            document.getElementById('edit_seasonMin').value = seasonMin;
            document.getElementById('edit_seasonMax').value = seasonMax;
            
            // Boolean checkbox'lar
            document.getElementById('edit_keto').checked = food.keto || false;
            document.getElementById('edit_lowcarb').checked = food.lowcarb || false;
            document.getElementById('edit_portionFixed').checked = food.portionFixed || false;
            document.getElementById('edit_fillerLunch').checked = food.fillerLunch || false;
            document.getElementById('edit_fillerDinner').checked = food.fillerDinner || false;
            document.getElementById('edit_isReversedSeason').checked = food.isReversedSeason || false;
            
            // Etiket alanlarƒ±
            document.getElementById('edit_tags').value = food.tags ? food.tags.join(', ') : '';
            document.getElementById('edit_compatibilityTags').value = food.compatibilityTags ? food.compatibilityTags.join(', ') : '';
            document.getElementById('edit_incompatibilityTags').value = food.incompatibilityTags ? food.incompatibilityTags.join(', ') : '';
            document.getElementById('edit_notes').value = food.notes || '';

            document.getElementById('editModal').classList.add('active');
        }
        
        // Kategori dropdown'ƒ±nƒ± food_list.json'dan doldur
        function populateCategoryDropdown() {
            const categorySelect = document.getElementById('edit_category');
            const uniqueCategories = new Set();
            
            // food_list.json'daki t√ºm kategorileri topla
            foodDatabase.forEach(food => {
                if (food.category) {
                    uniqueCategories.add(food.category);
                }
            });
            
            // Dropdown'ƒ± temizle ve yeniden doldur
            categorySelect.innerHTML = '<option value="">-- Kategori Se√ßin --</option>';
            [...uniqueCategories].sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // üÜï Yeni Yemek Ekle Modal'ƒ±nƒ± A√ß
        function openAddFoodModal() {
            editingFood = null; // Yeni ekleme modu
            
            // Modal ba≈ülƒ±ƒüƒ±nƒ± deƒüi≈ütir
            document.getElementById('editModalTitle').textContent = '‚ûï Yeni Yemek Ekle';
            
            // Kategori dropdown'ƒ±nƒ± doldur
            populateCategoryDropdown();
            
            // T√ºm form alanlarƒ±nƒ± temizle
            document.getElementById('edit_name').value = '';
            document.getElementById('edit_protein').value = 0;
            document.getElementById('edit_carbs').value = 0;
            document.getElementById('edit_fat').value = 0;
            document.getElementById('edit_calories').value = 0;
            document.getElementById('edit_category').value = '';
            document.getElementById('edit_role').value = '';
            
            // MealType checkbox'larƒ± temizle
            document.getElementById('edit_mealType_breakfast').checked = false;
            document.getElementById('edit_mealType_lunch').checked = false;
            document.getElementById('edit_mealType_dinner').checked = false;
            
            // DietTypes checkbox'larƒ± temizle
            document.getElementById('edit_dietType_ketojenik').checked = false;
            document.getElementById('edit_dietType_akdeniz').checked = false;
            document.getElementById('edit_dietType_vegan').checked = false;
            document.getElementById('edit_dietType_glutensiz').checked = false;
            
            // Diƒüer alanlarƒ± temizle
            document.getElementById('edit_minQuantity').value = '';
            document.getElementById('edit_maxQuantity').value = '';
            document.getElementById('edit_step').value = '';
            document.getElementById('edit_yemek_portionMultiplier').value = 1;
            document.getElementById('edit_seasonMin').value = '';
            document.getElementById('edit_seasonMax').value = '';
            
            // Boolean checkbox'larƒ± temizle
            document.getElementById('edit_keto').checked = false;
            document.getElementById('edit_lowcarb').checked = false;
            document.getElementById('edit_portionFixed').checked = false;
            document.getElementById('edit_fillerLunch').checked = false;
            document.getElementById('edit_fillerDinner').checked = false;
            document.getElementById('edit_isReversedSeason').checked = false;
            
            // Etiket alanlarƒ±nƒ± temizle
            document.getElementById('edit_tags').value = '';
            document.getElementById('edit_compatibilityTags').value = '';
            document.getElementById('edit_incompatibilityTags').value = '';
            document.getElementById('edit_notes').value = '';
            
            // Modal'ƒ± a√ß
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingFood = null;
            // Ba≈ülƒ±ƒüƒ± varsayƒ±lana d√∂nd√ºr
            document.getElementById('editModalTitle').textContent = 'üçΩÔ∏è Yemek D√ºzenle';
        }

        // Helper: foodDatabase array'ini Supabase formatƒ±na √ßevir (categories yapƒ±sƒ±)
        function convertFoodDatabaseToSupabaseFormat() {
            // foodDatabase flat array, category bilgisi her yemekte var
            const categoryMap = {};
            
            foodDatabase.forEach(food => {
                const categoryName = food.category || 'Dƒ∞ƒûER';
                if (!categoryMap[categoryName]) {
                    categoryMap[categoryName] = [];
                }
                categoryMap[categoryName].push(food);
            });
            
            // Kategori sƒ±rasƒ±na g√∂re sƒ±rala
            const categoryOrder = ['KAHVALTI', '√ñƒûLEN', 'AK≈ûAM', 'ATI≈ûT.', 'Dƒ∞ƒûER'];
            const categories = categoryOrder
                .filter(name => categoryMap[name]) // Sadece var olan kategorileri al
                .map(name => ({
                    category: name,
                    items: categoryMap[name]
                }));
            
            // Tanƒ±msƒ±z kategoriler varsa ekle
            Object.keys(categoryMap).forEach(name => {
                if (!categoryOrder.includes(name)) {
                    categories.push({
                        category: name,
                        items: categoryMap[name]
                    });
                }
            });
            
            return { categories };
        }

        async function saveFoodEdit() {
            // editingFood null ise yeni ekleme modundayƒ±z

            // Form verilerini al
            const mealTypeArray = [];
            if (document.getElementById('edit_mealType_breakfast').checked) mealTypeArray.push('breakfast');
            if (document.getElementById('edit_mealType_lunch').checked) mealTypeArray.push('lunch');
            if (document.getElementById('edit_mealType_dinner').checked) mealTypeArray.push('dinner');
            
            const dietTypesArray = [];
            if (document.getElementById('edit_dietType_ketojenik').checked) dietTypesArray.push('ketojenik');
            if (document.getElementById('edit_dietType_akdeniz').checked) dietTypesArray.push('akdeniz');
            if (document.getElementById('edit_dietType_vegan').checked) dietTypesArray.push('vegan');
            if (document.getElementById('edit_dietType_glutensiz').checked) dietTypesArray.push('glutensiz');
            
            // Yeni ekleme mi yoksa d√ºzenleme mi?
            const isNewFood = !editingFood;
            const originalFoodName = isNewFood ? null : editingFood.name;
            
            const updatedFood = {
                ...(editingFood || {}), // Yeni ekleme ise bo≈ü obje
                name: document.getElementById('edit_name').value.trim(),
                calories: parseFloat(document.getElementById('edit_calories').value) || 0,
                protein: parseFloat(document.getElementById('edit_protein').value) || 0,
                carbs: parseFloat(document.getElementById('edit_carbs').value) || 0,
                fat: parseFloat(document.getElementById('edit_fat').value) || 0,
                category: document.getElementById('edit_category').value.trim(),
                role: document.getElementById('edit_role').value.trim(),
                mealType: mealTypeArray,
                dietTypes: dietTypesArray,
                minQuantity: parseFloat(document.getElementById('edit_minQuantity').value) || undefined,
                maxQuantity: parseFloat(document.getElementById('edit_maxQuantity').value) || undefined,
                step: parseFloat(document.getElementById('edit_step').value) || undefined,
                multiplier: parseFloat(document.getElementById('edit_yemek_portionMultiplier').value) || 1,
                seasonRange: (() => {
                    const min = parseInt(document.getElementById('edit_seasonMin').value);
                    const max = parseInt(document.getElementById('edit_seasonMax').value);
                    if (min && max) return `[${min},${max}]`;
                    return undefined;
                })(),
                keto: document.getElementById('edit_keto').checked,
                lowcarb: document.getElementById('edit_lowcarb').checked,
                portionFixed: document.getElementById('edit_portionFixed').checked,
                fillerLunch: document.getElementById('edit_fillerLunch').checked,
                fillerDinner: document.getElementById('edit_fillerDinner').checked,
                isReversedSeason: document.getElementById('edit_isReversedSeason').checked,
                tags: document.getElementById('edit_tags').value.split(',').map(k => k.trim()).filter(k => k),
                compatibilityTags: document.getElementById('edit_compatibilityTags').value.split(',').map(k => k.trim()).filter(k => k),
                incompatibilityTags: document.getElementById('edit_incompatibilityTags').value.split(',').map(k => k.trim()).filter(k => k),
                notes: document.getElementById('edit_notes').value.trim()
            };

            // Modal'ƒ± kapat ve loading g√∂ster
            closeEditModal();
            
            const loadingDiv = document.createElement('div');
            loadingDiv.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10001; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                    <div style="font-size: 18px; font-weight: 600; color: #667eea;">Supabase'e kaydediliyor...</div>
                    <div style="font-size: 14px; color: #666; margin-top: 10px;">L√ºtfen bekleyin</div>
                </div>
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000;"></div>
            `;
            document.body.appendChild(loadingDiv);

            try {
                if (isNewFood) {
                    // üÜï Yeni yemek ekleme
                    // Aynƒ± isimde yemek var mƒ± kontrol et
                    const existingFood = foodDatabase.find(f => f.name === updatedFood.name);
                    if (existingFood) {
                        document.body.removeChild(loadingDiv);
                        alert('‚ùå Bu isimde bir yemek zaten mevcut!\n\nL√ºtfen farklƒ± bir isim kullanƒ±n.');
                        openAddFoodModal(); // Formu tekrar a√ß
                        // Girilen deƒüerleri geri y√ºkle
                        document.getElementById('edit_name').value = updatedFood.name;
                        return;
                    }
                    
                    // Yeni yemeƒüi veritabanƒ±na ekle
                    foodDatabase.push(updatedFood);
                    
                    // Supabase'e kaydet (kategorilere g√∂re grupla)
                    const foodListData = convertFoodDatabaseToSupabaseFormat();
                    await DAL.updateFoodList(foodListData);
                    
                    // Loading'i kaldƒ±r
                    document.body.removeChild(loadingDiv);
                    
                    console.log('‚úÖ Yeni yemek Supabase\'e eklendi:', updatedFood.name);
                    alert(`‚úÖ Ba≈üarƒ±lƒ±!\n\n"${updatedFood.name}" yemeƒüi Supabase'e eklendi.`);
                } else {
                    // ‚úèÔ∏è Mevcut yemek d√ºzenleme
                    const index = foodDatabase.findIndex(f => f.name === originalFoodName);
                    if (index !== -1) {
                        foodDatabase[index] = updatedFood;
                    }

                    // Supabase'e kaydet (kategorilere g√∂re grupla)
                    const foodListData = convertFoodDatabaseToSupabaseFormat();
                    await DAL.updateFoodList(foodListData);

                    // Loading'i kaldƒ±r
                    document.body.removeChild(loadingDiv);
                    
                    console.log('‚úÖ Yemek Supabase\'de g√ºncellendi:', updatedFood.name);
                    alert(`‚úÖ Ba≈üarƒ±lƒ±!\n\n"${updatedFood.name}" yemeƒüi Supabase'de g√ºncellendi.`);
                }

                // ƒ∞statistikleri ve ekranƒ± yenile
                updateStats();
                displayFoods();

            } catch (error) {
                // Loading'i kaldƒ±r
                document.body.removeChild(loadingDiv);

                console.error('Supabase kaydetme hatasƒ±:', error);
                alert(`‚ùå Supabase'e kaydedilemedi!\n\nHata: ${error.message}`);
            }
        }

        // üóëÔ∏è Sƒ∞LME FONKSƒ∞YONU
        function deleteFoodFromCard(cardElement) {
            try {
                const foodData = cardElement.getAttribute('data-food');
                const food = JSON.parse(decodeURIComponent(atob(foodData)));
                deleteFood(food);
            } catch (error) {
                console.error('Food data parse hatasƒ±:', error);
                alert('Bir hata olu≈ütu. L√ºtfen sayfayƒ± yenileyin.');
            }
        }

        async function deleteFood(food) {
            if (!confirm(`‚ùå "${food.name}" yemeƒüini silmek istediƒüinize emin misiniz?\n\nBu i≈ülem geri alƒ±namaz!`)) {
                return;
            }

            // Loading g√∂ster
            const loadingDiv = document.createElement('div');
            loadingDiv.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10001; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üóëÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 600; color: #dc3545;">Supabase'den siliniyor...</div>
                    <div style="font-size: 14px; color: #666; margin-top: 10px;">L√ºtfen bekleyin</div>
                </div>
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000;"></div>
            `;
            document.body.appendChild(loadingDiv);

            try {
                // Veritabanƒ±ndan sil
                const index = foodDatabase.findIndex(f => f.name === food.name);
                if (index !== -1) {
                    foodDatabase.splice(index, 1);
                }

                // Supabase'e kaydet (kategorilere g√∂re grupla)
                const foodListData = convertFoodDatabaseToSupabaseFormat();
                await DAL.updateFoodList(foodListData);

                // Loading'i kaldƒ±r
                document.body.removeChild(loadingDiv);

                console.log('‚úÖ Yemek Supabase\'den silindi:', food.name);
                alert(`‚úÖ Ba≈üarƒ±lƒ±!\n\n"${food.name}" yemeƒüi Supabase'den kalƒ±cƒ± olarak silindi.`);

                // ƒ∞statistikleri ve ekranƒ± yenile
                updateStats();
                displayFoods();

            } catch (error) {
                // Loading'i kaldƒ±r
                document.body.removeChild(loadingDiv);

                console.error('Supabase silme hatasƒ±:', error);
                alert(`‚ùå Supabase'den silinemedi!\n\nHata: ${error.message}`);
            }
        }

        // ESC ile modallarƒ± kapat
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                // closeTokenModal() kaldƒ±rƒ±ldƒ± - GitHub modalƒ± yok
                closeEditModal();
            }
        });

        // ========================================
        // YENƒ∞: Akƒ±llƒ± Dropdown Fonksiyonlarƒ±
        // ========================================

        // Yemek E≈üle≈ütirme Dropdown
        function renderYemekEslestirmeList() {
            const container = document.getElementById('yemekEslestirmeList');
            if (!container) return;

            // ‚úÖ META ALANLARI Fƒ∞LTRELE (version, aciklama, sonGuncelleme, eslestirmeler)
            const metaKeys = ['version', 'aciklama', 'sonGuncelleme', 'eslestirmeler'];
            const validEntries = Object.entries(yemekVeritabaniEslestirme).filter(([key]) => !metaKeys.includes(key));

            if (validEntries.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Hen√ºz e≈üle≈ütirme yok</div>';
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            validEntries.forEach(([key, value]) => {
                // ‚úÖ G√úVENLƒ∞K: value obje deƒüilse atla
                if (!value || typeof value !== 'object') {
                    console.warn(`‚ö†Ô∏è Ge√ßersiz e≈üle≈ütirme formatƒ±: ${key}`, value);
                    return;
                }
                
                const orijinal = value.orijinalMetin || key;
                
                // üîß Hem eski format (hedefYemek string) hem yeni format (hedefYemekler array) destekle
                let hedef = '';
                if (value.hedefYemek && typeof value.hedefYemek === 'string') {
                    // Eski format: tek yemek adƒ±
                    hedef = value.hedefYemek;
                } else if (value.hedefYemekler && Array.isArray(value.hedefYemekler)) {
                    // Yeni format: rotasyonlu yemekler
                    hedef = value.hedefYemekler.join(' / ');
                } else if (typeof value === 'string') {
                    // √áok eski format: direkt string
                    hedef = value;
                } else {
                    // Fallback: obje varsa JSON g√∂ster
                    hedef = JSON.stringify(value);
                }
                
                const notlar = value.notlar || '';
                const rotasyon = value.rotasyonModu ? ` (üîÑ ${value.rotasyonModu})` : '';
                
                html += `
                    <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; padding: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="margin-bottom: 5px;">
                                <strong style="color: #2196F3;">${orijinal}</strong>
                                <span style="color: #999; margin: 0 8px;">‚Üí</span>
                                <strong style="color: #28a745;">${hedef}</strong>${rotasyon}
                            </div>
                            ${notlar ? `<div style="font-size: 12px; color: #666;">üìù ${notlar}</div>` : ''}
                        </div>
                        <div style="display: flex; gap: 6px;">
                            <button class="btn" onclick="editYemekEslestirme('${key}')" style="background: #ffc107; color: #000; padding: 6px 12px; font-size: 12px;">
                                ‚úèÔ∏è D√ºzenle
                            </button>
                            <button class="btn" onclick="deleteYemekEslestirme('${key}')" style="background: #dc3545; color: white; padding: 6px 12px; font-size: 12px;">
                                üóëÔ∏è Sil
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Yemek yasak listesini render et
        function renderYemekYasakList() {
            const container = document.getElementById('yemekYasakList');
            if (!container) return;

            // ‚úÖ META ALANLARI Fƒ∞LTRELE (version, aciklama, sonGuncelleme, yasaklar)
            const metaKeys = ['version', 'aciklama', 'sonGuncelleme', 'yasaklar'];
            const validEntries = Object.entries(yemekVeritabaniYasaklar).filter(([key]) => !metaKeys.includes(key));

            if (validEntries.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Hen√ºz yasak yok</div>';
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            
            validEntries.forEach(([key, value]) => {
                // ‚úÖ G√úVENLƒ∞K: value obje deƒüilse atla
                if (!value || typeof value !== 'object') {
                    console.warn(`‚ö†Ô∏è Ge√ßersiz yasak formatƒ±: ${key}`, value);
                    return;
                }
                
                const orijinal = value.orijinalMetin || key;
                // ‚úÖ Her iki key'i de kontrol et (yasaklananYemekler veya yasakliYemekler)
                const yasaklar = value.yasaklananYemekler || value.yasakliYemekler || [];
                const neden = value.neden || '';
                
                html += `
                    <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <strong style="color: #856404;">${orijinal}</strong>
                                ${neden ? `<div style="font-size: 12px; color: #666; margin-top: 4px;">üí¨ ${neden}</div>` : ''}
                            </div>
                            <div style="display: flex; gap: 6px;">
                                <button class="btn" onclick="editYemekYasak('${key}')" style="background: #ffc107; color: #000; padding: 6px 12px; font-size: 12px;">
                                    ‚úèÔ∏è D√ºzenle
                                </button>
                                <button class="btn" onclick="deleteYemekYasak('${key}')" style="background: #dc3545; color: white; padding: 6px 12px; font-size: 12px;">
                                    üóëÔ∏è Sil
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px;">
                            ${yasaklar.map(y => `<span style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px;">üö´ ${y}</span>`).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Yemek e≈üle≈ütirmeyi kaydet
        async function saveYemekEslestirme() {
            const aramaTxt = document.getElementById('yemekEslestirmeArama').value.trim();
            const hedefTxt = document.getElementById('yemekEslestirmeHedef').value.trim();

            if (!aramaTxt || !hedefTxt) {
                alert('‚ö†Ô∏è L√ºtfen her iki alanƒ± da doldurun!');
                return;
            }

            try {
                // Normalize key
                const key = normalizeText(aramaTxt);

                console.log('üíæ Supabase\'e e≈üle≈ütirme kaydediliyor...');
                
                // Mevcut e≈üle≈ütirmeleri al
                const currentMappings = await window.DAL.getFoodDatabaseMappings();
                
                // ‚úÖ YENƒ∞ FORMAT: hedefYemekler (array) + rotasyonModu
                currentMappings[key] = {
                    orijinalMetin: aramaTxt,
                    hedefYemekler: [hedefTxt], // ‚úÖ ARRAY formatƒ± (rotasyon i√ßin)
                    rotasyonModu: 'sirayla',
                    eklemeTarihi: new Date().toISOString(),
                    notlar: `"${aramaTxt}" ‚Üí "${hedefTxt}" e≈üle≈ütirildi`
                };
                
                // Supabase'e kaydet (DAL zaten wrapper ekleyecek)
                await window.DAL.updateFoodDatabaseMappings(currentMappings);
                
                // Local state'i g√ºncelle
                yemekVeritabaniEslestirme = currentMappings;
                
                // üî• EKRANI G√úNCELLE
                clearYemekEslestirmeForm();
                renderYemekEslestirmeList();
                
                showNotification(`‚úÖ E≈üle≈ütirme kaydedildi: ${aramaTxt} ‚Üí ${hedefTxt}`, 'success');
            } catch (error) {
                console.error('‚ùå E≈üle≈ütirme kayƒ±t hatasƒ±:', error);
                showNotification('‚ö†Ô∏è Supabase kayƒ±t hatasƒ±!', 'error');
            }
        }

        // Yemek yasaƒüƒ± kaydet
        async function saveYemekYasak() {
            const aramaTxt = document.getElementById('yemekYasakArama').value.trim();
            const nedenTxt = document.getElementById('yemekYasakNeden').value.trim();

            if (!aramaTxt || currentYemekYasakItems.length === 0) {
                alert('‚ö†Ô∏è L√ºtfen arama terimini ve en az bir yasaklƒ± yemek ekleyin!');
                return;
            }

            try {
                // Normalize key
                const key = normalizeText(aramaTxt);

                console.log('üíæ Supabase\'e yasak kaydediliyor...');
                
                // Mevcut yasaklarƒ± al
                const currentProhibitions = await window.DAL.getFoodDatabaseProhibitions();
                const yasaklar = currentProhibitions.yasaklar || currentProhibitions;
                
                // Yeni yasak ekle
                yasaklar[key] = {
                    orijinalMetin: aramaTxt,
                    yasakliYemekler: currentYemekYasakItems,
                    eklemeTarihi: new Date().toISOString(),
                    neden: nedenTxt || `"${aramaTxt}" bu yemeklerle e≈üle≈ümemeli`
                };
                
                // Wrapper object ile kaydet
                const prohibitionsData = {
                    version: "1.0",
                    aciklama: "≈ûablonlardaki yemeklerin food_list.json'da yanlƒ±≈ü e≈üle≈ümesini √∂nlemek i√ßin yasaklar",
                    sonGuncelleme: new Date().toISOString(),
                    yasaklar: yasaklar
                };
                
                // Supabase'e kaydet
                await window.DAL.updateFoodDatabaseProhibitions(prohibitionsData);
                
                // Local state'i g√ºncelle
                yemekVeritabaniYasaklar = yasaklar;
                
                // üî• EKRANI G√úNCELLE
                clearYemekYasakForm();
                renderYemekYasakList();
                
                showNotification(`üö´ Yasak kaydedildi: ${aramaTxt}`, 'success');
            } catch (error) {
                console.error('‚ùå Yasak kayƒ±t hatasƒ±:', error);
                showNotification('‚ö†Ô∏è Supabase kayƒ±t hatasƒ±!', 'error');
            }
        }

        // ========================================
        // YENƒ∞: Akƒ±llƒ± Dropdown Fonksiyonlarƒ±
        // ========================================

        // Yemek E≈üle≈ütirme Dropdown
        function showYemekEslestirmeDropdown() {
            const dropdown = document.getElementById('yemekEslestirmeDropdown');
            if (!dropdown) return;
            filterYemekEslestirmeDropdown('');
            dropdown.style.display = 'block';
        }

        function hideYemekEslestirmeDropdown() {
            const dropdown = document.getElementById('yemekEslestirmeDropdown');
            if (dropdown) dropdown.style.display = 'none';
        }

        function filterYemekEslestirmeDropdown(searchText) {
            const dropdown = document.getElementById('yemekEslestirmeDropdown');
            if (!dropdown || !foodDatabase || foodDatabase.length === 0) return;

            const search = searchText.toLowerCase().trim();
            
            let filtered = foodDatabase;
            if (search) {
                filtered = foodDatabase.filter(food => 
                    food.name.toLowerCase().includes(search)
                );
            }

            filtered = filtered.slice(0, 50);

            if (filtered.length === 0) {
                dropdown.innerHTML = '<div style="padding: 10px; text-align: center; color: #999;">Sonu√ß bulunamadƒ±</div>';
                dropdown.style.display = 'block';
                return;
            }

            let html = filtered.map(food => `
                <div onclick="selectYemekEslestirmeHedef('${food.name.replace(/'/g, "\\'")}')" 
                     style="padding: 10px; cursor: pointer; background: white; color: #333; border-bottom: 1px solid #eee; transition: background 0.2s;"
                     onmouseover="this.style.background='#e6f7e6'"
                     onmouseout="this.style.background='white'">
                    <strong>${food.name}</strong>
                    <span style="font-size: 11px; color: #999; margin-left: 8px;">
                        (${food.calories} kcal, P: ${food.protein}g, C: ${food.carbs}g, F: ${food.fat}g)
                    </span>
                </div>
            `).join('');

            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
        }

        function selectYemekEslestirmeHedef(yemekAdi) {
            document.getElementById('yemekEslestirmeHedef').value = yemekAdi;
            hideYemekEslestirmeDropdown();
        }

        // Sayfa dƒ±≈üƒ±na tƒ±klanƒ±nca dropdown kapat
        document.addEventListener('click', (e) => {
            const inputEslestirme = document.getElementById('yemekEslestirmeHedef');
            const dropdownEslestirme = document.getElementById('yemekEslestirmeDropdown');
            
            if (dropdownEslestirme && inputEslestirme && !dropdownEslestirme.contains(e.target) && e.target !== inputEslestirme) {
                hideYemekEslestirmeDropdown();
            }
        });

        // ========================================
        // Yemek Yasak Dropdown (MEVCUT)
        // ========================================

        // Yasak listesine item ekle (manuel veya dropdown)
        function addYemekYasakItemManual() {
            const hedefTxt = document.getElementById('yemekYasakHedef').value.trim();
            if (!hedefTxt) {
                alert('‚ö†Ô∏è L√ºtfen yasaklƒ± yemek adƒ±nƒ± girin!');
                return;
            }

            addYemekYasakItemFromText(hedefTxt);
        }

        function addYemekYasakItemFromText(yemekAdi) {
            if (!yemekAdi) return;

            if (currentYemekYasakItems.includes(yemekAdi)) {
                showNotification(`‚ö†Ô∏è "${yemekAdi}" zaten eklendi!`, 'warning');
                return;
            }

            currentYemekYasakItems.push(yemekAdi);
            renderYemekYasakItems();
            document.getElementById('yemekYasakHedef').value = '';
            hideYemekYasakDropdown();
            showNotification(`‚úÖ "${yemekAdi}" eklendi`, 'success');
        }

        // Dropdown g√∂ster/gizle
        function showYemekYasakDropdown() {
            const dropdown = document.getElementById('yemekYasakDropdown');
            if (!dropdown) return;

            // ƒ∞lk a√ßƒ±lƒ±≈üta t√ºm yemekleri g√∂ster
            filterYemekYasakDropdown('');
            dropdown.style.display = 'block';
        }

        function hideYemekYasakDropdown() {
            const dropdown = document.getElementById('yemekYasakDropdown');
            if (dropdown) dropdown.style.display = 'none';
        }

        // Dropdown filtrele
        function filterYemekYasakDropdown(searchText) {
            const dropdown = document.getElementById('yemekYasakDropdown');
            if (!dropdown || !foodDatabase || foodDatabase.length === 0) return;

            const search = searchText.toLowerCase().trim();
            
            // Filtreleme
            let filtered = foodDatabase;
            if (search) {
                filtered = foodDatabase.filter(food => 
                    food.name.toLowerCase().includes(search)
                );
            }

            // Maksimum 50 sonu√ß g√∂ster (performans i√ßin)
            filtered = filtered.slice(0, 50);

            if (filtered.length === 0) {
                dropdown.innerHTML = '<div style="padding: 10px; text-align: center; color: #999;">Sonu√ß bulunamadƒ±</div>';
                dropdown.style.display = 'block';
                return;
            }

            // Dropdown HTML olu≈ütur
            let html = filtered.map(food => {
                const isAdded = currentYemekYasakItems.includes(food.name);
                const bgColor = isAdded ? '#f0f0f0' : 'white';
                const textColor = isAdded ? '#999' : '#333';
                const cursor = isAdded ? 'not-allowed' : 'pointer';
                const checkmark = isAdded ? '‚úì ' : '';

                return `
                    <div onclick="${isAdded ? '' : `addYemekYasakItemFromText('${food.name.replace(/'/g, "\\'")}')`}" 
                         style="padding: 10px; cursor: ${cursor}; background: ${bgColor}; color: ${textColor}; border-bottom: 1px solid #eee; transition: background 0.2s;"
                         onmouseover="if(!${isAdded}) this.style.background='#ffe6e6'"
                         onmouseout="this.style.background='${bgColor}'">
                        ${checkmark}<strong>${food.name}</strong>
                        <span style="font-size: 11px; color: #999; margin-left: 8px;">
                            (${food.calories} kcal, P: ${food.protein}g, C: ${food.carbs}g, F: ${food.fat}g)
                        </span>
                    </div>
                `;
            }).join('');

            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
        }

        // Sayfa dƒ±≈üƒ±na tƒ±klanƒ±nca dropdown kapat
        document.addEventListener('click', (e) => {
            const input = document.getElementById('yemekYasakHedef');
            const dropdown = document.getElementById('yemekYasakDropdown');
            
            if (dropdown && input && !dropdown.contains(e.target) && e.target !== input) {
                hideYemekYasakDropdown();
            }
        });

        // Yasak listesine item ekle (ESKƒ∞ FONKSƒ∞YON - YENƒ∞ ƒ∞Sƒ∞M)
        function addYemekYasakItem() {
            addYemekYasakItemManual();
        }

        // Yasak item'larƒ± render et
        function renderYemekYasakItems() {
            const container = document.getElementById('yemekYasakItems');
            if (!container) return;

            if (currentYemekYasakItems.length === 0) {
                container.innerHTML = '<span style="color: #999; font-size: 13px;">Yasaklƒ± yemekleri yukarƒ±dan ekleyin...</span>';
                return;
            }

            container.innerHTML = currentYemekYasakItems.map((item, index) => `
                <span style="background: #dc3545; color: white; padding: 6px 12px; border-radius: 16px; font-size: 13px; display: inline-flex; align-items: center; gap: 6px;">
                    ${item}
                    <button onclick="removeYemekYasakItem(${index})" style="background: none; border: none; color: white; cursor: pointer; font-size: 16px; padding: 0;">√ó</button>
                </span>
            `).join('');
        }

        // Yasak item'ƒ± sil
        function removeYemekYasakItem(index) {
            currentYemekYasakItems.splice(index, 1);
            renderYemekYasakItems();
        }

        // E≈üle≈ütirmeyi d√ºzenle
        function editYemekEslestirme(key) {
            const item = yemekVeritabaniEslestirme[key];
            if (!item) return;

            // Tab'a ge√ß (zaten a√ßƒ±k olmalƒ±)
            switchTab('yemekEslestirme');

            // Formu doldur
            document.getElementById('yemekEslestirmeArama').value = item.orijinalMetin || key;
            document.getElementById('yemekEslestirmeHedef').value = item.hedefYemek || item;

            // Scroll to form
            document.getElementById('yemekEslestirmeArama').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('yemekEslestirmeArama').focus();
        }

        // Yasaƒüƒ± d√ºzenle
        function editYemekYasak(key) {
            const item = yemekVeritabaniYasaklar[key];
            if (!item) return;

            // Tab'a ge√ß
            switchTab('yemekYasak');

            // Formu doldur
            document.getElementById('yemekYasakArama').value = item.orijinalMetin || key;
            document.getElementById('yemekYasakNeden').value = item.neden || '';
            
            // Yasak itemlarƒ± doldur
            currentYemekYasakItems = [...(item.yasakliYemekler || [])];
            renderYemekYasakItems();

            // Scroll to form
            document.getElementById('yemekYasakArama').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('yemekYasakArama').focus();
        }

        // E≈üle≈ütirmeyi sil
        async function deleteYemekEslestirme(key) {
            if (!confirm(`"${yemekVeritabaniEslestirme[key]?.orijinalMetin}" e≈üle≈ütirmesini silmek istediƒüinize emin misiniz?`)) {
                return;
            }

            try {
                console.log('üíæ Supabase\'e e≈üle≈ütirme silme kaydediliyor...');
                
                // Mevcut e≈üle≈ütirmeleri al
                const currentMappings = await window.DAL.getFoodDatabaseMappings();
                
                // Sil
                delete currentMappings[key];
                
                // Supabase'e kaydet (DAL zaten wrapper ekleyecek)
                await window.DAL.updateFoodDatabaseMappings(currentMappings);
                
                // Local state'i g√ºncelle
                yemekVeritabaniEslestirme = currentMappings;
                
                // üî• EKRANI G√úNCELLE
                renderYemekEslestirmeList();
                
                showNotification('‚úÖ E≈üle≈ütirme silindi', 'success');
            } catch (error) {
                console.error('‚ùå E≈üle≈ütirme silme hatasƒ±:', error);
                showNotification('‚ö†Ô∏è Supabase kayƒ±t hatasƒ±!', 'error');
                // Hata durumunda geri y√ºkle
                await loadYemekVeritabaniEslestirme();
                renderYemekEslestirmeList();
            }
        }

        // Yasaƒüƒ± sil
        async function deleteYemekYasak(key) {
            if (!confirm(`"${yemekVeritabaniYasaklar[key]?.orijinalMetin}" yasaƒüƒ±nƒ± silmek istediƒüinize emin misiniz?`)) {
                return;
            }

            try {
                // ‚úÖ 1. Supabase'den g√ºncel veriyi oku
                console.log('üì• G√ºncel yasaklar Supabase\'den okunuyor...');
                const currentProhibitions = await window.DAL.getFoodDatabaseProhibitions();
                const yasaklar = currentProhibitions.yasaklar || currentProhibitions;

                // 2. Silme i≈ülemini yap
                delete yasaklar[key];

                // 3. Wrapper ile kaydet
                const prohibitionsData = {
                    version: "1.0",
                    aciklama: "≈ûablonlardaki yemeklerin food_list.json'da yanlƒ±≈ü e≈üle≈ümesini √∂nlemek i√ßin yasaklar",
                    sonGuncelleme: new Date().toISOString(),
                    yasaklar: yasaklar
                };

                console.log('üì§ Supabase\'e yasak silme kaydediliyor...');
                await window.DAL.updateFoodDatabaseProhibitions(prohibitionsData);

                // 4. Yerel state'i g√ºncelle ve ekranƒ± yenile
                yemekVeritabaniYasaklar = yasaklar;
                renderYemekYasakList();

                showNotification('‚úÖ Yasak silindi', 'success');
            } catch (error) {
                console.error('‚ùå Yasak silme hatasƒ±:', error);
                showNotification('‚ö†Ô∏è Supabase kayƒ±t hatasƒ±!', 'error');
                // Hata durumunda geri y√ºkle
                await loadYemekVeritabaniYasaklar();
                renderYemekYasakList();
            }
        }

        // Form temizleme
        function clearYemekEslestirmeForm() {
            document.getElementById('yemekEslestirmeArama').value = '';
            document.getElementById('yemekEslestirmeHedef').value = '';
        }

        function clearYemekYasakForm() {
            document.getElementById('yemekYasakArama').value = '';
            document.getElementById('yemekYasakHedef').value = '';
            document.getElementById('yemekYasakNeden').value = '';
            currentYemekYasakItems = [];
            renderYemekYasakItems();
        }

        // ========================================
        // YENƒ∞ FONKSYONLAR SONU
        // ========================================

        // Ba≈ülat
        loadFoodData();
    </script>

    <!-- D√ºzenleme Modali -->
    <div class="edit-modal-overlay" id="editModal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h2 id="editModalTitle">üçΩÔ∏è Yemek D√ºzenle</h2>
                <button class="modal-close" onclick="closeEditModal()">√ó</button>
            </div>
            <div class="edit-modal-body">
                <form id="editForm" onsubmit="event.preventDefault(); saveFoodEdit();">
                    <div class="form-group">
                        <label>Yemek Adƒ± *</label>
                        <input type="text" id="edit_name" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Kalori (kcal) *</label>
                            <input type="number" id="edit_calories" step="0.1" readonly style="background: #f0f0f0; cursor: not-allowed;" title="Otomatik hesaplanƒ±r: (Karb√ó4) + (Protein√ó4) + (Yaƒü√ó9)">
                        </div>
                        <div class="form-group">
                            <label>Protein (g) *</label>
                            <input type="number" id="edit_protein" step="0.1" required oninput="calculateCalories()">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Karbonhidrat (g) *</label>
                            <input type="number" id="edit_carbs" step="0.1" required oninput="calculateCalories()">
                        </div>
                        <div class="form-group">
                            <label>Yaƒü (g) *</label>
                            <input type="number" id="edit_fat" step="0.1" required oninput="calculateCalories()">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Kategori *</label>
                            <select id="edit_category" required>
                                <option value="">-- Kategori Se√ßin --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Rol *</label>
                            <select id="edit_role" required>
                                <option value="">-- Rol Se√ßin --</option>
                                <option value="mainDish">Ana Yemek</option>
                                <option value="sideDish">Yan Yemek</option>
                                <option value="drink">ƒ∞√ßecek</option>
                                <option value="supplement">Takviye</option>
                                <option value="snack">Atƒ±≈ütƒ±rmalƒ±k</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>√ñƒü√ºn Tipi (Birden fazla se√ßilebilir)</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 8px;">
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_mealType_breakfast" value="breakfast">
                                üåÖ Kahvaltƒ±
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_mealType_lunch" value="lunch">
                                ‚òÄÔ∏è √ñƒüle
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_mealType_dinner" value="dinner">
                                üåô Ak≈üam
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Porsiyon √áarpanƒ±</label>
                            <input type="number" id="edit_portionMultiplier" step="0.1" value="1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Diyet Tipleri (Birden fazla se√ßilebilir)</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 8px;">
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_dietType_ketojenik" value="ketojenik">
                                ü•ó Ketojenik
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_dietType_akdeniz" value="akdeniz">
                                üåä Akdeniz
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_dietType_vegan" value="vegan">
                                üå± Vegan
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_dietType_glutensiz" value="glutensiz">
                                üåæ Glutensiz
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Min Miktar</label>
                            <input type="number" id="edit_minQuantity" step="0.1" placeholder="Minimum porsiyon">
                        </div>
                        <div class="form-group">
                            <label>Max Miktar</label>
                            <input type="number" id="edit_maxQuantity" step="0.1" placeholder="Maksimum porsiyon">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Adƒ±m (Step)</label>
                            <input type="number" id="edit_step" step="0.1" placeholder="Artƒ±≈ü miktarƒ±">
                        </div>
                        <div class="form-group">
                            <label>Porsiyon √áarpanƒ±</label>
                            <input type="number" id="edit_yemek_portionMultiplier" step="0.1" value="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Sezon Ba≈ülangƒ±√ß (Ay)</label>
                            <input type="number" id="edit_seasonMin" min="1" max="12" placeholder="1-12">
                        </div>
                        <div class="form-group">
                            <label>Sezon Biti≈ü (Ay)</label>
                            <input type="number" id="edit_seasonMax" min="1" max="12" placeholder="1-12">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üè∑Ô∏è √ñzel √ñzellikler</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 8px;">
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_keto">
                                ü•ó Keto
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_lowcarb">
                                üìâ D√º≈ü√ºk Karb
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_portionFixed">
                                üîí Porsiyon Sabit
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_fillerLunch">
                                üçΩÔ∏è √ñƒüle Dolgu
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_fillerDinner">
                                üåô Ak≈üam Dolgu
                            </label>
                            <label class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" id="edit_isReversedSeason">
                                üîÑ Ters Sezon
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üè∑Ô∏è Etiketler (Tags) - virg√ºlle ayƒ±rƒ±n</label>
                        <input type="text" id="edit_tags" placeholder="√∂r: domates, meyve, salata">
                    </div>

                    <div class="form-group">
                        <label>‚úÖ Uyumluluk Etiketleri (compatibilityTags) - virg√ºlle ayƒ±rƒ±n</label>
                        <input type="text" id="edit_compatibilityTags" placeholder="√∂r: tavuk, zeytinyaƒüƒ±">
                    </div>

                    <div class="form-group">
                        <label>‚ùå Uyumsuzluk Etiketleri (incompatibilityTags) - virg√ºlle ayƒ±rƒ±n</label>
                        <input type="text" id="edit_incompatibilityTags" placeholder="√∂r: s√ºt, peynir">
                    </div>

                    <div class="form-group">
                        <label>üìù Notlar</label>
                        <textarea id="edit_notes" placeholder="Ek bilgiler, √∂zel notlar..."></textarea>
                    </div>
                </form>
            </div>
            <div class="edit-modal-footer">
                <button class="cancel-btn" type="button" onclick="closeEditModal()">ƒ∞ptal</button>
                <button class="save-btn" type="button" onclick="saveFoodEdit()">üíæ Kaydet</button>
            </div>
        </div>
    </div>

</body>
</html>

